{"version":3,"sources":["assets/viewPano/resource sync /^/.*$","assets/mc.png","assets/rotating.png","assets/pano_inside-2-medium.png","assets/viewPano/compassBase.svg","assets/viewPano/compassDiamond.svg","assets/viewPano/zoomerBase.svg","assets/viewPano/zoomerPlus.svg","assets/viewPano/zoomerMinus.svg","assets/viewPano/resource/ir/pano-20190925110216-ir.png","assets/viewPano/resource/ir/pano-20190925110449-ir.png","assets/viewPano/resource/ir/pano-20190925110659-ir.png","assets/viewPano/resource/ir/pano-20190925111017-ir.png","assets/viewPano/resource/ir/pano-20190925111251-ir.png","assets/viewPano/resource/ir/pano-20190925111418-ir.png","assets/viewPano/resource/ir/pano-20190925111628-ir.png","assets/viewPano/resource/ir/pano-20190925111907-ir.png","assets/viewPano/resource/ir/pano-20190925112004-ir.png","assets/viewPano/resource/ir/pano-20190925112226-ir.png","assets/viewPano/resource/ir/pano-20190925112242-ir.png","assets/viewPano/resource/ir/pano-20190925112410-ir.png","assets/viewPano/resource/ir/pano-20190925112418-ir.png","assets/viewPano/resource/ir/pano-20190925112754-ir.png","assets/viewPano/resource/ir/pano-20190925112757-ir.png","assets/viewPano/resource/ir/pano-20190925112929-ir.png","assets/viewPano/resource/ir/pano-20190925112944-ir.png","assets/viewPano/resource/ir/pano-20190925113109-ir.png","assets/viewPano/resource/ir/pano-20190925113249-ir.png","assets/viewPano/resource/ir/pano-20190925113346-ir.png","assets/viewPano/resource/mx/pano-20190724143458-mx.png","assets/viewPano/resource/mx/pano-20190724143833-mx.png","assets/viewPano/resource/mx/pano-20190724145944-mx.png","assets/viewPano/resource/mx/pano-20190724150711-mx.png","assets/viewPano/resource/mx/pano-20190724151238-mx.png","assets/viewPano/resource/mx/pano-20190724151553-mx.png","assets/viewPano/resource/mx/pano-20190925110216-mx.png","assets/viewPano/resource/mx/pano-20190925110449-mx.png","assets/viewPano/resource/mx/pano-20190925110659-mx.png","assets/viewPano/resource/mx/pano-20190925111017-mx.png","assets/viewPano/resource/mx/pano-20190925111251-mx.png","assets/viewPano/resource/mx/pano-20190925111418-mx.png","assets/viewPano/resource/mx/pano-20190925111628-mx.png","assets/viewPano/resource/mx/pano-20190925111907-mx.png","assets/viewPano/resource/mx/pano-20190925112004-mx.png","assets/viewPano/resource/mx/pano-20190925112226-mx.png","assets/viewPano/resource/mx/pano-20190925112242-mx.png","assets/viewPano/resource/mx/pano-20190925112410-mx.png","assets/viewPano/resource/mx/pano-20190925112418-mx.png","assets/viewPano/resource/mx/pano-20190925112754-mx.png","assets/viewPano/resource/mx/pano-20190925112757-mx.png","assets/viewPano/resource/mx/pano-20190925112929-mx.png","assets/viewPano/resource/mx/pano-20190925112944-mx.png","assets/viewPano/resource/mx/pano-20190925113109-mx.png","assets/viewPano/resource/mx/pano-20190925113249-mx.png","assets/viewPano/resource/mx/pano-20190925113346-mx.png","components/layout.tsx","api/index.ts","maps.tsx","components/pano/minimap.tsx","components/pano/pageStore.tsx","components/pano/location.tsx","components/pano/shapes.tsx","components/spinner.tsx","components/pano/compass.tsx","components/pano/zoomer.tsx","components/pano/panotype.tsx","pano.tsx","App.tsx","index.tsx"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","Container","styled","div","Header","Content","NAV_BAR_HEIGHT","getDataFromJSONArray","data","query","i","length","resultArr","param","push","result","getNeighbors","nhood","Array","isArray","hood","arr","getTwoNeighbors","mockedNeighbors","prototype","apply","type","apis","getPanoFileNameById","Promise","mockedPanos","getPanoCoordById","getAllPanoIdAndCoord","getPanoAllAttrById","getNeighborsById","neighborhood","MarkerClusterer","require","StyledMap","Map","show","REGIONS","boston","lat","lng","concord","center","parseNeighborhoodIntoRegion","MapContainer","props","showGSV","isClustererRendered","markerClusterer","bounds","google","maps","LatLngBounds","Clusterer","state","coords","addMarkers","styles","width","height","url","textColor","gridSize","minimumClusterSize","a","async","api","then","coordArr","coord","region","setState","prevProps","this","prevloc","location","pathname","split","history","action","streetView","setVisible","extend","LatLng","index","marker","Marker","position","title","event","addListener","gotoPano","visible","goBack","console","log","ref","onMapMounted","zoom","initialCenter","match","params","Component","EnhancedMap","GoogleApiWrapper","apiKey","process","withRouter","useEffect","minimapElement","infoBoxElement","mapHandlerInit","document","getElementsByClassName","addEventListener","preventDefault","style","minimapZoomIn","minimapZoomOut","opacity","infoBoxHovered","infoBoxUnhovered","window","back","Pegman","pmanOffsetY","mapCenter","origin","Point","pegIcon","size","Size","anchor","custom","lid","icon","key","zIndex","observer","pStore","dotIcon","showComp","panoPageStore","setBounds","z","onClick","onReady","streetViewControl","fullscreenControl","mapTypeControl","rotateControl","Minimap","InfoBox","backBox","className","PanoPageStore","cameraY","setPegmanRotationOffsetYFromCameraY","zoomLock","panoType","typeLock","deg","Math","ceil","PI","floor","observable","Location","calibration","fname","neighborArr","types","setAllAttr","filename","getNeighborIds","updateCalibration","camera","rotation","y","alert","loc","geolib","neighbor","getDistanceTo","getBearingTo","Arrow","mesh","material","geometry","hitbox","THREE","vertices","faces","Rings","color","Compass","compassRotationReactionDisposer","cBaseSrc","cDiamondSrc","compassElement","compassHandlerInit","getElementById","compassOnClick","reset","CompassElement","src","alt","RotateCompass","transform","setCompassRotationReaction","reaction","ZoomController","zoomerReactionDisposer","zBase","zPlus","zMinus","zoomerInElement","zoomerOutElement","currZoomLevel","zoomerElementHandlerInit","zoomerInOnClick","zoomerOutOnClick","zoomerInOver","zoomerOutOver","zoomerInOut","zoomerOutOut","zoomIn","zoomOut","ZoomerElement","PanoTypeController","currPanoType","changePanoTypeInStore","mxOnClick","irOnClick","panoTypeSelectorElement","ButtonGroup","Button","TWEEN","zoomLevelFov","0","1","2","PanoTypes","Pano","currLoc","neighbors","undefined","panoIdChangeReactionDisposer","panoViewDirectionResetReactionDisposer","panoZoomChangeReactionDisposer","panoTypeChangeReactionDisposer","canvasStyle","cursor","loaderSpinnerElem","animationLock","wheelLockTemp","eventListenersLoaded","cylindergeometry","cylindermaterial","cylindermesh","texture","loader","lines","tempcylindergeometry","tempcylindermaterial","tempcylindermesh","threeCamera","threeScene","threeCanvas","cone0","cone1","cone2","conevis0","conevis1","conevis2","coneg0","coneg1","coneg2","pinSphereGeometry","pinNeedleGeometry","pin0","pin1","pin2","n0","n1","n2","mouseSelectedArrowMesh","onScroll","path","wheelDeltaY","animatePanoTypeChangeTextureFade","fadeBegin","at","crossfade","Tween","to","easing","Easing","Quadratic","InOut","onUpdate","onComplete","transparent","remove","dispose","scale","start","teleportToScene","visibility","load","generatePanoFilename","side","add","animateTeleportationTextureFade","updateValues","err","error","fov","updateProjectionMatrix","setNeighbors","RenderArrows","RenderSpinner","iter","get","next","value","cos","bearing","x","sin","isLoading","RenderPano","bind","disableBodyScroll","querySelector","panoId","loadTexture","clear","nidArr","nid","nextLoc","addNeighbor","n","set","distance","isPointer","CameraLookNorth","changeZoom","changePanoType","setPanoPageStoreIDChangeReaction","setCameraResetReaction","setZoomChangeReaction","setTypeChangeReaction","includes","setAllReactions","zoomBegin","zoomEnd","tweenZoom","rotBegin","tweenRot","updatePegmanOffset","useThree","gl","scene","canvas","raycaster","setSize","clientWidth","clientHeight","lookAt","cone","conemesh","useRef","conemesh1","conemesh2","compassPlate","current","coneVisible0","coneVisible1","coneVisible2","conegroup0","conegroup1","c0Sphere","c1Sphere","c2Sphere","conegroup2","coneBoundingSpheres","mouse","arrow","mouseplateG","isDraggin","rcObjects","planegeo","planemat","rcplane","computeBoundingSphere","center1","boundingSphere","v1","Vector3","coneGroup","localToWorld","distanceToArrowInWorldCoord","children","center0","v0","boundinSphere","distanceTo","mouseDown","mouseX","startX","rotateScene","deltaX","clientX","innerWidth","clientY","innerHeight","setFromCamera","intersects","intersectObjects","intersect","copy","point","evt","onMouseMove","targetTouches","pageX","onTouchMove","aspect","animateTransition","camAt","endAt","rotEnd","zVal","xVal","fovValue","chain","transitionToScene","pid","compassGroup","triGeo","triGeoArr","setChildrenOpacity","group","opc","computeFaceNormals","testMesh","useRender","update","dist","parent","min","getClosestArrowAndAdjustDirection","onPointerOver","object","toggleCursor","onPointerOut","userData","attach","onPointerUp","navigateWithMouse","routes","Interface","gmapComponent","panoComponent","renderPano","r","activeClassName","component","exact","from","ReactDOM","render"],"mappings":"g8IAAA,IAAIA,EAAM,CACT,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,IACnC,kCAAmC,KAIpC,SAASC,EAAeC,GACvB,IAAIC,EAAKC,EAAsBF,GAC/B,OAAOG,EAAoBF,GAE5B,SAASC,EAAsBF,GAC9B,IAAIG,EAAoBC,EAAEN,EAAKE,GAAM,CACpC,IAAIK,EAAI,IAAIC,MAAM,uBAAyBN,EAAM,KAEjD,MADAK,EAAEE,KAAO,mBACHF,EAEP,OAAOP,EAAIE,GAEZD,EAAeS,KAAO,WACrB,OAAOC,OAAOD,KAAKV,IAEpBC,EAAeW,QAAUR,EACzBS,EAAOC,QAAUb,EACjBA,EAAeE,GAAK,I,olCCnEpBU,EAAOC,QAAU,87H,mCCAjBD,EAAOC,QAAU,IAA0B,sC,cCA3CD,EAAOC,QAAU,0T,qCCAjBD,EAAOC,QAAU,IAA0B,yC,gBCA3CD,EAAOC,QAAU,IAA0B,4C,gBCA3CD,EAAOC,QAAU,IAA0B,wC,gBCA3CD,EAAOC,QAAU,IAA0B,wC,gBCA3CD,EAAOC,QAAU,IAA0B,yC,kBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD,EAAOC,QAAU,IAA0B,oD,gBCA3CD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","file":"static/js/main.89f9e428.chunk.js","sourcesContent":["var map = {\n\t\"./ir/pano-20190925110216-ir.png\": 132,\n\t\"./ir/pano-20190925110449-ir.png\": 133,\n\t\"./ir/pano-20190925110659-ir.png\": 134,\n\t\"./ir/pano-20190925111017-ir.png\": 135,\n\t\"./ir/pano-20190925111251-ir.png\": 136,\n\t\"./ir/pano-20190925111418-ir.png\": 137,\n\t\"./ir/pano-20190925111628-ir.png\": 138,\n\t\"./ir/pano-20190925111907-ir.png\": 139,\n\t\"./ir/pano-20190925112004-ir.png\": 140,\n\t\"./ir/pano-20190925112226-ir.png\": 141,\n\t\"./ir/pano-20190925112242-ir.png\": 142,\n\t\"./ir/pano-20190925112410-ir.png\": 143,\n\t\"./ir/pano-20190925112418-ir.png\": 144,\n\t\"./ir/pano-20190925112754-ir.png\": 145,\n\t\"./ir/pano-20190925112757-ir.png\": 146,\n\t\"./ir/pano-20190925112929-ir.png\": 147,\n\t\"./ir/pano-20190925112944-ir.png\": 148,\n\t\"./ir/pano-20190925113109-ir.png\": 149,\n\t\"./ir/pano-20190925113249-ir.png\": 150,\n\t\"./ir/pano-20190925113346-ir.png\": 151,\n\t\"./mx/pano-20190724143458-mx.png\": 152,\n\t\"./mx/pano-20190724143833-mx.png\": 153,\n\t\"./mx/pano-20190724145944-mx.png\": 154,\n\t\"./mx/pano-20190724150711-mx.png\": 155,\n\t\"./mx/pano-20190724151238-mx.png\": 156,\n\t\"./mx/pano-20190724151553-mx.png\": 157,\n\t\"./mx/pano-20190925110216-mx.png\": 158,\n\t\"./mx/pano-20190925110449-mx.png\": 159,\n\t\"./mx/pano-20190925110659-mx.png\": 160,\n\t\"./mx/pano-20190925111017-mx.png\": 161,\n\t\"./mx/pano-20190925111251-mx.png\": 162,\n\t\"./mx/pano-20190925111418-mx.png\": 163,\n\t\"./mx/pano-20190925111628-mx.png\": 164,\n\t\"./mx/pano-20190925111907-mx.png\": 165,\n\t\"./mx/pano-20190925112004-mx.png\": 166,\n\t\"./mx/pano-20190925112226-mx.png\": 167,\n\t\"./mx/pano-20190925112242-mx.png\": 168,\n\t\"./mx/pano-20190925112410-mx.png\": 169,\n\t\"./mx/pano-20190925112418-mx.png\": 170,\n\t\"./mx/pano-20190925112754-mx.png\": 171,\n\t\"./mx/pano-20190925112757-mx.png\": 172,\n\t\"./mx/pano-20190925112929-mx.png\": 173,\n\t\"./mx/pano-20190925112944-mx.png\": 174,\n\t\"./mx/pano-20190925113109-mx.png\": 175,\n\t\"./mx/pano-20190925113249-mx.png\": 176,\n\t\"./mx/pano-20190925113346-mx.png\": 177\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 42;","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAA0CAYAAAAqunDVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9kEGAgqEZIAg5UAAAs7SURBVGjevZpbjF1ndcd//31mxmOPx/bEcWKcQBOapKkTBTBY3KFKC6nacBHhgbZSURHwQOAFzhY8cBEXCcE5AokHUFUEqHmIkCo1KomQgkqlJqFABCgxIcVuSNI4xOPY4xmP537O/vOw197nm+PbmRtbGp05l/3tb31rff/1X//1ic2+2gbIAAENoIEN0gh2gdQBjF2+ln8Feda7v6kNTWH9d7cK6omU70eBUaShMCRDysKAeJoIA8EWUoHdRepiryAt0NTKRtdV6/JEU6VRIKQxYGcYAbaRynFt18+Ij2oD4cK/gxXgLLBUL1r/Am6qUT2DMqSd2DvCG5Ux6ZjVhDthVBGfqQ7N0kAnXnTy/TLSHE3NrzUsteZwaxXbkXYDWYRSFV6VR4w9B8wjdS46kbbB3oa0A3t7b0aJceVYBdJpmuoMapjW5B3YA2wHivr+0jsd7AWkeewhpB3AbuwJpJ3ASEyUCLkF7LPAGWAWaR4Q9k5gWwBNtUDVYs1gz5Fnl/WaBjRoGGkiJuz63nIVp2lqkbYPANcDY9gjMTGvAojV/1eT7WAvIU1jHyXPZml7HNgVIJPuyyXsKfLMG/NUqxgG9vWBgIFFYBq4CrgtjOnWAHAhxKshwqwarzfxIWASeDy8vhdpuA9MloHTlzJs6LL7SNqWAEHpHTiJtAv79WFwAXRqqLYbETozwBzSbO01exhpHHssvNEFijB6BftKpLdiP4/0ZKDqFckCDSM1gM76jJKgqXMJ2nXJs0navh771vhVN0JR4aVZ4Cns4wmI7Ad2R0gejZxk7CHg5cANATyKkBPwUuyrgEfCe/vieVM01dlo+BGbcwf2InArcF0fWBRhxDFgHPsWpFuBlwH767Asr0bkouPAs0hHgCexh4GbkK6OsZ0k6CNIJ7EhzxYvl7e0Rji/DumVtevtDDiH9BD2PqR/Cq+MJPunl2TTPZXCt7SI/TjSPRGSrw3jHVGwAjxMnp0bBNa1jsT75xEuID0NHMO+A+kdsZlTD2YRcivYy/G87UkuKhKEHAbOYt+D9CRwGJiIUP0lTZ3YGkbRC8WbsWeBBeBupOsiV1VgMoI0A/wceAz7RWA+Vn8MuBY4BBwOAzt1TpIy7P8hz75DqzgInCDPptZCldbO/VJmAa1YYSdAcQb4N+AX2Dcj3Y59YyDaCaSngIew/xt4EXg38MbgkBVtGgKep6nP/fFYehWKbd8JvDP2yALSvcBzwN3YdwE3rULS1TkKpIeB78Qi3IH99joHSt+iqf9dK5ndWOnR89xdwJuQPge8AfvfkbYl9Ob8e3rcrgKN55Fej70f6YPYbfLs2HoM2rhRPfCYQLob+GISQoOOXSHcOaT3Yf+IPFveSLGYRaVa1UfrvT6A/cUkF2nNC1sS3/uRXrU5RWLJ74zUpSmf54lLh9+7gPtWFX3rvUr07GDfRJ49s6ZoWUWTyrpmd6BYl1axFFRnhKYWL1q+lwMeAP5l0/ZnuSjDSJ8H3j/QorqOtJHgqSui7Sx4VSN+NBcP+AtgLtDsd6EluPZkuRifQGpvunhT8cWSZ642rBJ2SmJ7LU09Rdv7gmaBtCjabkT5oEh+LwbleU0w8iGk+4H3ROH3NPAk0nHsJ5AObrJBVRjfS1N/H14YA/40GP9MlDq7or57IArLHZEmikrKypJNvox0VfL+LE2tYN8GvAbpvUh/ib0bOLjpXurVYn8XBn0B+CrSR4G/xl6K8r+LtIJ9FXanlhYgy4DhpADrhqtHksdU4XhNAr9PA3/LVl1V/moVtyA1on4qkG5BOlfzy9KQsWD9dRrJEsmKpJAbCzQrmULbY9gN7IoOnUX6MyS21LByr09FNaB4/ngSRQ6t0elcsosM6MTYLrAfqYhYXwJOYU/0LQhbFIqTfcg6dEH0S+aSXRaFyoHPJQMPA+NRR7HFl4PVuw/2L+bZMGq1cqoLFHHbyLPJJFQzYFsoO1tskgvgGqCo66+mTq9Sfav9t8pT5Y2rPVfCpsJTO+K7MzGIgYPY98aCeEs8VE7yCNK28E6GNE3bo8niK8SdBn1GdJEUkxWtYgiYSdw5Hq9HYxAj3QgciyJRW+AhIf02VKrRWOgG8FjMp1r8DOlUbIkKSMjCtZ2YnCORnUkk5RFaxQT20VoKhhuBfdjf3kLk+wj2ochJDpX3Z8DeJJcZexZpuNbxpeUs4LCbDLkdez7ESsV3NwBP1J+VEvP7ge8CS7WkvHmeOkJTP0b6m6SqPkGePQdcnRg+RZ4V4anq3uWMpozdrS0vY7iDgsyWe+4A0umAcqKfdAMwjf1Aotpuxl7qIjVpFW8DroxxM+BHtIpdwN4k0R6nVQzXObQ0dLGC9KUELo29DXuyhvQyRK8F7kMaTZDmH4C7gJ9seG/1WM3XsX+DdFdo7CDNYT+ayHOK10mk8Yg2BdPoVEbNJ8BgYAdwLJSdyoMvI88ew/51osldF3rEX8Xn6QTXhnTlPvky0qeAD9d9KrsB/CwmvQe7iDnNAPPJniP0waKsfMs6aTHJUUN1bEMjDN5Jq7gV+Gek2bqFI70a+Efgduz/SJiAB/BO2g76LPA17I/VPLPkfb+jqXuxb6vTj9TAfgoYr9lPOdYieUaW1CrTSQIWcAXwDNLZeF8gvTwU1O8ndGUZOBQaxfuw7wwg0UWTc69XBfAr4AD2d5E+Gcy/6vvOAN+kVRxE2lXDOEySZyeiV+Y6JeXZXI9BtGv+NBEKarU5T0et9YokTIz9IPBW4L1JKsgCQO5B+gX2u4EPIe3H3rOqrwUnsY+FbngE+w7gPUhLCTAsYH8rmnKvTRTeDtKD2DtrrbBco7OVLK2+8nwEe2/y8Kptcwj7mrrDUYbqfyIdxv5QGFOpswJOAc8C/xpJc88qUcaeQroFeB1wfTDvIlmcWeyvxvvDtdfL18eRTgB7k0hYieIW8iwxqidQXoE9WjMMWKSpKdq+vY9cNrD/K3pNH49WD8l9C8CXaOrUBcSa0Qi1A30KlLGfBb4R4X8oWEW1GC+QZ4/S9kv6+OkZ8mzxfJberIntVBzgqGjHKG3vwn4oEm21VwrgzdjbkT6NfR9wDhiNjXsyjg6cf+XZIvbvE4K8Hfsk9veArwA3Ih2KxO945iR59iit4soEXIS9lBp0fulRKUb2mb7NvDM42I+RFmqDy1C5GftNwMNIecjIc8D/09TyJajQb8PbLwAt8uwzIfLciXRtX/dkGunntL0vTs4QYd4Fpvp1S11CzxtD2hPN6opkzkTj7TDS1dFMqx7cCMZxLDp/o/0r2Df+eFStp6JreD3SRNL2rMjzszR1hFaxN0qetIA9RZ6t9CtOl+vOj2PvSg52GHspypA/AV5ZS2eVdl4dBGnqgQFaQm/BHoujP6TiSRj0SDTL99V95F6z7xR5tnQhPTK7jPI5G/skTaajSPuA57AfRJoKbypJvNOrUsX5e4q6RkvPWJTP6QDPkWc/iDDenzTGq/1cGtQjDus4HFKCwRVUp77KUHQg3ExocC+N5tso9k/Js+MDjD0B3B57Ywk4CrwQOWlPvX96DTlHI3vpUh2RbCAqk2cL2KeCd6ULsQP7QPz/BE3dDzyCdPyiXkpD0J7G/j/sn9DUD4FnIp1cHTJdet6pJLCXMWhw/bvXsmkAu5C2rzos1YPYJWAOe3HgvlKraIRkMFrXRf2Ht8pW7DnyzIPo64M9uToKl2fd2AdTwQVV8y7HASoYGVhlKr25E3scezhZKNVdeXsSaXZQgzbW8y0nNRakcriO+b7sPoBh1eGs9BTaEtJ83XVZY0dx7b3HsoldeXAu9tqL0f7pJAx70Gs5PLQc2sjJAIPyEMg6WqR/AP8TaUdhTpMSAAAAAElFTkSuQmCC\"","module.exports = __webpack_public_path__ + \"static/media/rotating.4957277e.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAMAAACecocUAAAACXBIWXMAAAAcAAAAHAAPAbmPAAAAIVBMVEUAAABVnbVRnbVRnbVdpb2l4fpVnb1dqcFVnblVobmFyeFl3ybiAAAAC3RSTlMAtb18tGwapUy9gIWpoGAAAABESURBVHja7f3HAcQwDMMAkFSzvf/A8V2aMgRfENRWAJBG0XITBuXl4tiWc0XEmkyYfrgLGehxxgnVxaWP7/P9Tr/f/h6CtgH6SIBB6wAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/compassBase.aa7ec710.svg\";","module.exports = __webpack_public_path__ + \"static/media/compassDiamond.01b956a5.svg\";","module.exports = __webpack_public_path__ + \"static/media/zoomerBase.72cda6d6.svg\";","module.exports = __webpack_public_path__ + \"static/media/zoomerPlus.97ab4b97.svg\";","module.exports = __webpack_public_path__ + \"static/media/zoomerMinus.f208fd9c.svg\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110216-ir.e436fa7a.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110449-ir.2b9a5cbf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110659-ir.a2e90f11.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111017-ir.7804e8a7.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111251-ir.1b3027ec.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111418-ir.7e941c28.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111628-ir.bf5f978f.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111907-ir.47d30c92.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112004-ir.a5abc0af.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112226-ir.07e80c3c.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112242-ir.1ed00077.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112410-ir.4cd7789f.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112418-ir.e4d0d342.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112754-ir.e36c9994.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112757-ir.468d2175.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112929-ir.27fa8a9d.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112944-ir.fbaa0fdf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113109-ir.6a5de669.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113249-ir.27c6c9bf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113346-ir.fc6926bf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724143458-mx.072de3d6.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724143833-mx.0732614b.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724145944-mx.0c7531e1.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724150711-mx.f67813cf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724151238-mx.3f9e7726.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724151553-mx.c1e8bceb.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110216-mx.1df9c980.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110449-mx.3cccead9.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110659-mx.7dd0729f.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111017-mx.3f2e4787.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111251-mx.fa3472c7.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111418-mx.cfa23e44.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111628-mx.f9883877.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111907-mx.98fc0c7d.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112004-mx.67654aa1.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112226-mx.697a7ab6.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112242-mx.f78fa3f7.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112410-mx.bcaaf9a8.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112418-mx.3793296d.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112754-mx.027a553c.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112757-mx.154dcd69.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112929-mx.1680bdb6.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112944-mx.b1f87148.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113109-mx.d5176dc0.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113249-mx.a47ff4f3.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113346-mx.4f0beaa1.png\";","import React from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nexport const NAV_BAR_HEIGHT = 0;\r\nexport const NAV_BAR_PADDING = 2;\r\n\r\nexport const Container = styled.div`\r\n\twidth: 100vw;\r\n\theight: 100vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n`;\r\n\r\nexport const Header = styled.div`\r\n\tposition: fixed;\r\n\tz-index: 999;\r\n\ttop: 10px;\r\n\tright: 10px;\r\n\tpadding: 12px;\r\n\theight: 50px;\r\n\tdisplay: flex;\r\n\tjustify-content: flex-start;\r\n\talign-items: center;\r\n\tbackground-color: #f8f8f8;\r\n    box-shadow: 2px 2px gray;\r\n\tcursor: pointer;\r\n\t& .ir-nav-item {\r\n\t\tmargin-right: 0.5rem;\r\n\t\tmargin-left: 0.5rem;\r\n\t\ttext-decoration: none;\r\n\t\tcolor: rgba(0, 0, 0, 0.5);\r\n\t\tfont-size: 1.2rem;\r\n\t}\r\n\r\n\t& .ir-nav-item__active {\r\n\t\tcolor: #000000;\r\n\t}\r\n`;\r\n\r\nexport const Content = styled.div`\r\n\tflex: 1;\r\n\tpadding: 2px;\r\n\tpadding-top: ${NAV_BAR_HEIGHT + 2}px;\r\n`;\r\n","import axios from 'axios'\r\nimport mockedPanos from '../mocks/panos.json'\r\nimport mockedNeighbors from '../mocks/neighbors.json'\r\n\r\n/*\r\nconst hostname = \"localhost\";\r\nconst port = \"8080\";\r\nconst url = 'http://' + hostname + ':' + port + '/api';\r\n\r\nconst api = axios.create({\r\n    baseURL: url,\r\n})\r\n\r\nexport const insertPano = payload => api.post(`/pano`, payload)\r\nexport const getAllPanos = () => api.get(`/panos/all`)\r\nexport const deletePanoById = id => api.delete(`/pano/${id}`)\r\nexport const getPanoById = id => api.get(`/pano/${id}`)\r\n\r\nexport const getPanoCoordById = (id) => api.get(`/pano/coord/${id}`)\r\nexport const getPanoFileNameById = id => api.get(`/pano/fname/${id}`)\r\nexport const getPanoAllAttrById = (id) => api.get(`/pano/allAttr/${id}`)\r\nexport const updateCalibrationById = (id, payload) => api.put(`/pano/cal/${id}`, payload)\r\n*/\r\n\r\nfunction getDataFromJSONArray(data, query, id?){\r\n    if(!id){//case when api resembles to 'getAllBlaBlah'\r\n        for(var i=0; i<data.length; i++){\r\n            var resultArr = [];\r\n            for(let param of query){\r\n                resultArr.push(data[i][param]);\r\n            }\r\n            return resultArr;\r\n        }\r\n    }\r\n    for(var i=0; i<data.length; i++){//case when api resembles \"getBlahBlahById\"\r\n        if(data[i][\"id\"]===id){\r\n            if(query.length===0)//case specific for \"getAllAttrById\"\r\n                return data[i];\r\n            var result = {};\r\n            for(let param of query){\r\n                result[param]=data[i][param];\r\n            }\r\n            return result;\r\n        }\r\n    }\r\n}\r\n\r\nfunction getMatrixNeighbors(){\r\n//used for getting irregular neighbor hood neighbors\r\n}\r\n\r\nfunction getNeighbors(id, nhood){\r\n    if(Array.isArray(nhood)){//in the case of a junction\r\n        var result = [];\r\n        for(let hood of nhood){\r\n            let arr = getTwoNeighbors(id,mockedNeighbors[hood]);\r\n            Array.prototype.push.apply(result, arr);\r\n        }\r\n        return result;\r\n    }else{ //linear or circular\r\n        let arr = getTwoNeighbors(id, mockedNeighbors[nhood]);\r\n        return arr;\r\n    }\r\n}\r\n\r\nfunction getTwoNeighbors(id, hood){\r\n    if(hood.map.length<2){\r\n        return [];\r\n    }\r\n    switch (hood.type) {\r\n        case \"linear\":\r\n            for (var i = 0; i < hood.map.length; i++) {\r\n                if (id === hood.map[i]) {\r\n                    if (i === 0) //first one, return second as neighbor\r\n                        return [hood.map[1]];\r\n                    else if (i === hood.map.length - 1) //last one, return the second to the last as neighbor \r\n                        return [hood.map[hood.map.length - 2]];\r\n                    //Otherwise, return the neighboring two\r\n                    return [hood.map[i - 1], hood.map[i + 1]];\r\n                }\r\n            }\r\n            break;\r\n\r\n        case \"circular\":\r\n            for (var i = 0; i < hood.map.length; i++) {\r\n                if (id === hood.map[i]) {\r\n                    if (i === 0) //first one, return last and second as neighbor\r\n                        return [hood.map[1], hood.map[hood.map.length-1]];\r\n                    else if (i === hood.map.length - 1) //last one, return the second to the last and first as neighbor \r\n                        return [hood.map[hood.map.length - 2], hood.map[0]];\r\n                    //Otherwise, return the neighboring two\r\n                    return [hood.map[i - 1], hood.map[i + 1]];\r\n                }\r\n            }\r\n            break;\r\n\r\n        case \"irregular\":\r\n            return hood.map[id];\r\n    }\r\n    \r\n    \r\n}\r\n\r\n// Should use superagent to mock when we have time\r\nexport const getPanoCoordById = (id) => Promise.resolve({ data: { data: getDataFromJSONArray(mockedPanos,[\"coord\"], id) } })\r\n//export const getAllPanoIdAndCoord = () => Promise.resolve({ data: { data: getDataFromJSON(mockedPanos,[\"id\", \"coord\"]) } })\r\nexport const getAllPanoIdAndCoord = () => Promise.resolve({ data: { data: mockedPanos } })\r\nexport const getPanoAllAttrById = (id) => Promise.resolve({ data: { data: getDataFromJSONArray(mockedPanos,[], id) } })\r\nexport const getPanoFileNameById = (id) => Promise.resolve({ data: { data:  getDataFromJSONArray(mockedPanos,[\"filename\"], id) } })\r\nexport const getNeighborsById = (id, neighborhood) => Promise.resolve({ data: { data: getNeighbors(id, neighborhood) } })\r\n\r\nconst apis = {\r\n    //insertPano,\r\n    //getAllPanos,\r\n    //deletePanoById,\r\n    //getPanoById,\r\n    //updateCalibrationById,\r\n\r\n    getPanoFileNameById,\r\n    getPanoCoordById,\r\n    getAllPanoIdAndCoord,\r\n    getPanoAllAttrById,\r\n    getNeighborsById\r\n}\r\n\r\nexport default apis","import React, {Component, useRef, useEffect} from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport {Map, GoogleApiWrapper, Marker} from 'google-maps-react'\r\nimport {withRouter, RouteComponentProps} from 'react-router-dom'\r\nimport styled from 'styled-components'\r\nimport api from './api/index'\r\nimport { parse } from 'path'\r\n\r\nconst MarkerClusterer = require('node-js-marker-clusterer');\r\n\r\n// I believe there is a bug of google-maps-react\r\n// as it does not respect the custom style object you pass\r\n// in. So we have to use important for now\r\n// TODO:\r\n// look for better map candidate\r\nconst StyledMap = styled(Map)`\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative !important;\r\n`\r\n\r\nconst Container = styled.div<{show: boolean}>`\r\n  width: 100%;\r\n  height: 100%;\r\n  display: ${({show = false}) => (show ? 'block' : 'none')};\r\n\r\n  & > div {\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n`\r\n\r\nconst REGIONS = {\r\n  boston: {\r\n    lat: 42.36,\r\n    lng: -71.053\r\n  },\r\n  concord: {\r\n    lat: 42.45955,\r\n    lng: -71.3525\r\n  },\r\n  center: {\r\n    lat: 42.4,\r\n    lng: -71.2\r\n  }\r\n}\r\n\r\nconst parseNeighborhoodIntoRegion = (neighborhood) => {\r\n  if(Array.isArray(neighborhood)){\r\n    return parseNeighborhoodIntoRegion(neighborhood[0]);\r\n  }\r\n  switch (neighborhood){\r\n    case \"quincy\":\r\n      return \"boston\"\r\n    case \"atlave\":\r\n      return \"boston\";\r\n    case \"caa\":\r\n      return \"concord\";\r\n    case \"cab\":\r\n      return \"concord\";\r\n    case \"cdt\":\r\n      return \"concord\";\r\n  }\r\n  return null;\r\n}\r\n\r\nexport interface Coordinate {\r\n  id: string | number\r\n  lat: number\r\n  lng: number\r\n  region: string\r\n}\r\n\r\nexport interface MapContainerState {\r\n  coords?: Coordinate[]\r\n}\r\n\r\nexport interface MapContainerProps extends RouteComponentProps<{region?: string}> {}\r\n\r\nexport class MapContainer extends Component<MapContainerProps, MapContainerState> {\r\n  map;//ref to map instance\r\n  showGSV=false;\r\n  isClustererRendered=false;\r\n  markerClusterer;\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      coords: []\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    var getAllPanoCoords = async () => {\r\n      await api.getAllPanoIdAndCoord().then(result => {\r\n        var coordArr = []\r\n        let data = result.data.data\r\n        for (var i = 0; i < data.length; i++) {\r\n          coordArr.push({\r\n            id: data[i].id,\r\n            lat: data[i].coord.lat,\r\n            lng: data[i].coord.lng,\r\n            region: parseNeighborhoodIntoRegion( data[i].neighborhood )\r\n          })\r\n        }\r\n        this.setState({\r\n          coords: coordArr\r\n        })\r\n      })\r\n    }\r\n    getAllPanoCoords()\r\n  }\r\n\r\n  componentDidUpdate(prevProps){\r\n    if(!this.map){\r\n      return ;\r\n    }\r\n    const prevloc = prevProps.location.pathname.split(\"/\")[1];\r\n    const currAction = this.props.history.action;\r\n    \r\n    //-----very specific logic here, please dont not change the order of the following instructions\r\n    //-----the following logic handles the show/hide of google street view under different use cases and circumstances\r\n    if(currAction===\"PUSH\" && prevloc===\"viewPano\"){//in the case when user is in ir pano view and wants to click on region-bar\r\n      this.showGSV = false;\r\n    }\r\n    \r\n    if(!this.showGSV){//tells google to render/show google street view or not\r\n      this.map.streetView.setVisible(false);\r\n    }\r\n\r\n    if(prevloc===\"viewPano\"){//in the case when user exits/backs from ir pano view\r\n      this.showGSV = false;\r\n    }\r\n  }\r\n\r\n  bounds = new (this.props as any).google.maps.LatLngBounds()\r\n\r\n  setBounds() {\r\n    const {coords} = this.state\r\n    if (!coords) return\r\n\r\n    for (var i = 0; i < coords.length; i++) {\r\n      let coord = coords[i]\r\n      this.bounds.extend(\r\n        new (this.props as any).google.maps.LatLng({\r\n          lat: coord.lat,\r\n          lng: coord.lng\r\n        })\r\n      )\r\n    }\r\n  }\r\n\r\n  addMarkers(map, google) {\r\n    const {coords} = this.state\r\n    if (!coords) return\r\n    //console.log(map);\r\n    return coords.map((coord, index) => {\r\n      const marker = new google.maps.Marker({\r\n        position: { lat: coord.lat, lng: coord.lng },\r\n        map: map,\r\n        title: coord.id+\"&\"+coord.region\r\n      })\r\n      \r\n      google.maps.event.addListener(marker, 'click', () => {\r\n        this.gotoPano(marker.title);\r\n      });\r\n\r\n      return marker;\r\n    })\r\n  }\r\n\r\n  gotoPano(title) {\r\n    const arr = title.split(\"&\");\r\n    const id = arr[0];\r\n    const region = arr[1];\r\n    if(this.map.streetView.visible){\r\n      this.showGSV = true;\r\n    }\r\n    this.props.history.push(`/maps/${region}`);\r\n    this.props.history.push(`/viewPano/${id}`);\r\n  }\r\n\r\n  goBack(){\r\n    // @ts-ignore\r\n    this.props.history.goBack();\r\n    console.log(\"go back\");\r\n  }\r\n\r\n  get region() {\r\n    return this.props.match ? this.props.match.params.region : 'boston'\r\n  }\r\n\r\n  Clusterer = ({map, google}) => {\r\n    \r\n    if(this.isClustererRendered)\r\n      return (null);\r\n    if(!map)\r\n      return (null)\r\n    if(this.state.coords.length===0)\r\n      return (null);\r\n    \r\n    this.map = map;\r\n    this.markerClusterer = new MarkerClusterer(map, this.addMarkers(map, google), {\r\n      styles: [{\r\n        width: 53,\r\n        height: 52,\r\n        url: require('./assets/mc.png'),\r\n        textColor: 'white',\r\n      }],\r\n      gridSize: 20,\r\n      minimumClusterSize: 6\r\n    });\r\n    this.isClustererRendered = true;\r\n    return (null);\r\n  }\r\n\r\n  render() {\r\n\r\n    return (\r\n      \r\n      <StyledMap\r\n        ref={(this.props as any).onMapMounted}\r\n        google={(this.props as any).google}\r\n        zoom={11}\r\n        center={REGIONS[this.region]}\r\n        initialCenter={REGIONS.center}\r\n        bounds={this.bounds}\r\n      >\r\n        <this.Clusterer />\r\n      </StyledMap>\r\n    )\r\n  }\r\n}\r\n\r\n\r\nconst EnhancedMap = GoogleApiWrapper({\r\n  apiKey: `${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`\r\n \r\n})(MapContainer)\r\n\r\n// google-maps-react is making an higher-order-component\r\n// in a stupid way, as there is no way for us to change\r\n// the container tag (always div), and the container does not\r\n// accept className prop, which makes it hard for us to style\r\nexport default withRouter(props => {\r\n  useEffect(() => {\r\n    return () => {\r\n      console.log('GMap...dying')\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <Container show={!!props.match}>\r\n      <EnhancedMap {...props} />\r\n    </Container>\r\n  )\r\n})\r\n","import React, { Component, useEffect } from \"react\";\r\nimport { Map, GoogleApiWrapper, Marker } from \"google-maps-react\";\r\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\r\nimport styled from \"styled-components\";\r\nimport { observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport PanoPageStore from \"./pageStore\"\r\n\r\nimport api from \"../../api/index\";\r\n\r\nconst StyledMap = styled(Map)`\r\n\twidth: 100% !important;\r\n\theight: 100% !important;\r\n\tposition: relative !important;\r\n`;\r\n\r\nconst Container = styled.div`\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\r\n\t& > div {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n`;\r\n\r\nvar minimapElement, infoBoxElement;\r\nvar mapHandlerInit = () => {\r\n\tminimapElement = (document.getElementsByClassName('Minimap') as HTMLCollectionOf<HTMLElement>)[0];\r\n\t//console.log(minimapElement[0]);\r\n\tminimapElement.addEventListener(\"mouseover\", e => minimapZoomIn(e), false);\r\n\tminimapElement.addEventListener(\"mouseout\", e => minimapZoomOut(e), false);\r\n\r\n\tinfoBoxElement = (document.getElementsByClassName('InfoBox') as HTMLCollectionOf<HTMLElement>)[0];\r\n\tinfoBoxElement.addEventListener(\"mouseover\", e => infoBoxHovered(e), false);\r\n\tinfoBoxElement.addEventListener(\"mouseout\", e => infoBoxUnhovered(e), false);\r\n\tinfoBoxElement.addEventListener(\"mousedown\", e => goBack(e), false);\r\n}\r\nfunction minimapZoomIn(e){\r\n\te.preventDefault();\r\n\tminimapElement.style.width = \"250px\";\r\n\tminimapElement.style.height = \"200px\";\r\n}\r\n\r\nfunction minimapZoomOut(e){\r\n\te.preventDefault();\r\n\tminimapElement.style.width = \"200px\";\r\n\tminimapElement.style.height = \"100px\";\r\n}\r\n\r\nfunction infoBoxHovered(e){\r\n\te.preventDefault();\r\n\tinfoBoxElement.style.opacity = \"0.75\";\r\n}\r\n\r\nfunction infoBoxUnhovered(e){\r\n\te.preventDefault();\r\n\tinfoBoxElement.style.opacity = \"0.5\";\r\n}\r\n\r\nfunction goBack(e) {\r\n\te.preventDefault();\r\n\twindow.history.back();\r\n}\r\n\r\nexport interface Coordinate {\r\n\tid: string | number;\r\n\tlat: number;\r\n\tlng: number;\r\n}\r\nexport interface MapContainerState {\r\n\tshowComp: boolean;\r\n\tcoords?: Coordinate[];\r\n}\r\n\r\ntype center = {\r\n\tlng: string,\r\n\tlat: string,\r\n\tbearing: string\r\n}\r\n\r\nexport interface MapContainerProps extends RouteComponentProps<{PanoPageStore}> {}\r\n\r\nconst Pegman = ({ id, lat, lng, pmanOffsetY, google, map, mapCenter }) => {\r\n\r\n\tvar origin = new google.maps.Point(8, 9);\r\n\tif (pmanOffsetY) {\r\n\t\torigin = new google.maps.Point(8, pmanOffsetY);\r\n\t}\r\n\tvar pegIcon = {\r\n\t\turl: require(`../../assets/rotating.png`),\r\n\t\tsize: new google.maps.Size(44, 49),\r\n\t\torigin: origin,\r\n\t\tanchor: new google.maps.Point(22, 34),\r\n\t\tcustom: true\r\n\t};\r\n\r\n\treturn <Marker\r\n\t\tlid={id}\r\n\t\tposition={{lat: lat, lng: lng}}\r\n\t\ticon={pegIcon}\r\n\t\tkey={id}\r\n\t\tgoogle={google}\r\n\t\tmap={map}\r\n\t\tmapCenter={mapCenter}\r\n\t\tzIndex={100}\r\n\t/>\r\n}\r\n\r\n\r\n@observer\r\nclass MapContainer extends Component<MapContainerProps, MapContainerState> {\r\n\t\r\n\tpStore:PanoPageStore;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tshowComp: false\r\n\t\t};\r\n\t\tthis.pStore = (this.props as any).panoPageStore;\r\n\t}\r\n\t\r\n\r\n\tcomponentDidMount() {\r\n\t\tvar getAllPanoCoords = async () => {\r\n\t\t\tawait api.getAllPanoIdAndCoord().then(result => {\r\n\t\t\t\tvar coordArr = [];\r\n\t\t\t\tlet data = result.data.data;\r\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\tcoordArr.push({\r\n\t\t\t\t\t\tid: data[i].id,\r\n\t\t\t\t\t\tlat: data[i].coord.lat,\r\n\t\t\t\t\t\tlng: data[i].coord.lng\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tcoords: coordArr,\r\n\t\t\t\t\tshowComp: true\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t\tgetAllPanoCoords();\r\n\t}\r\n\r\n\tshowComponent(i) {\r\n\t\tif (i !== true && i !== false) return;\r\n\t\tthis.setState({ showComp: i });\r\n\t}\r\n\r\n\tbounds = new (this.props as any).google.maps.LatLngBounds();\r\n\r\n\tsetBounds() {\r\n\t\tfor (var i = 0; i < (this.state as any).coords.length; i++) {\r\n\t\t\tlet coord = (this.state as any).coords[i];\r\n\t\t\tthis.bounds.extend(\r\n\t\t\t\tnew (this.props as any).google.maps.LatLng({\r\n\t\t\t\t\tlat: coord.lat,\r\n\t\t\t\t\tlng: coord.lng\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tdotIcon = {\r\n\t\turl: require(`../../assets/pano_inside-2-medium.png`),\r\n\t\tsize: new (this.props as any).google.maps.Size(11, 11),\r\n\t\torigin: new (this.props as any).google.maps.Point(0, 0),\r\n\t\tanchor: new (this.props as any).google.maps.Point(5.5, 5.5)\r\n\t};\r\n\r\n\taddMarkers() {\r\n\t\tthis.setBounds();\r\n\t\t//let map = new Map(this.refs.map,);\r\n\t\t//(this.props as any).google.maps.fitBounds(this.bounds);\r\n\t\tvar icon;\r\n\t\tvar z = 1;\r\n\t\treturn (this.state as any).coords.map((coord, index) => {\r\n\t\t\tif ((this.state as any).coords[index].id === this.pStore.id) {\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\ticon = this.dotIcon;\r\n\t\t\t\tz++;\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Marker\r\n\t\t\t\t\t\tlid={coord.id}\r\n\t\t\t\t\t\tposition={{\r\n\t\t\t\t\t\t\tlat: coord.lat,\r\n\t\t\t\t\t\t\tlng: coord.lng\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonClick={e => {\r\n\t\t\t\t\t\t\treturn this.gotoPano(e.lid);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\ticon={icon}\r\n\t\t\t\t\t\tkey={coord.id}\r\n\t\t\t\t\t\tzIndex={z}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\r\n\tgotoPano(id) {\r\n\t\t// @ts-ignore\r\n\t\t//this.props.history.push(`/viewPano/${id}`);\r\n\t\t//console.log(\"Update id: \"+id);\r\n\t\tthis.pStore.id = id;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { showComp } = this.state;\r\n\r\n\t\treturn showComp ? (\r\n\t\t\t<>\r\n\t\t\t\t<StyledMap\r\n\t\t\t\t\tref={(this.props as any).onMapMounted}\r\n\t\t\t\t\tgoogle={(this.props as any).google}\r\n\t\t\t\t\tzoom={17}\r\n\t\t\t\t\tcenter={{ lat: this.pStore.lat, lng: this.pStore.lng }}\r\n\t\t\t\t\tinitialCenter={{ lat: this.pStore.lat, lng: this.pStore.lng }}\r\n\t\t\t\t\tbounds={this.bounds}\r\n\t\t\t\t\tonReady={mapHandlerInit}\r\n\t\t\t\t\tstreetViewControl={false}\r\n\t\t\t\t\tfullscreenControl={false}\r\n\t\t\t\t\tmapTypeControl={false}\r\n\t\t\t\t\trotateControl={false}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Pegman id={this.pStore.id} lat={this.pStore.lat} lng={this.pStore.lng} pmanOffsetY={this.pStore.pmanOffsetY} />\r\n\t\t\t\t\t{this.addMarkers()}\r\n\t\t\t\t</StyledMap>\r\n\t\t\t</>\r\n\t\t) : null;\r\n\t}\r\n}\r\n\r\nconst Minimap = GoogleApiWrapper({\r\n\tapiKey: `${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`\r\n})(withRouter(MapContainer));\r\n\r\n\r\nclass InfoBox extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t}\r\n\r\n\tbackBox(){\r\n\t\treturn(\r\n\t\t\t<div >\r\n\t\t\t\t<span> ← </span>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\ttextBox(){\r\n\t\treturn(\r\n\t\t\t<div>\r\n\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\trender(){\r\n\t\treturn(\r\n\t\t\t<this.backBox />\r\n\t\t)\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport default props => (\r\n\t<>\r\n\t\t<div className=\"Minimap\">\r\n\t\t\t<Container>\r\n\t\t\t\t<Minimap {...props} />\r\n\r\n\t\t\t</Container>\r\n\r\n\t\t</div>\r\n\t\t<div className=\"InfoBox\">\r\n\t\t\t<InfoBox />\r\n\t\t</div>\r\n\t</>\r\n);\r\n","import { observable } from \"mobx\";\r\n\r\nconst maxZoom = 2;\r\n\r\nexport default class PanoPageStore {\r\n\t@observable lng:number;\r\n\t@observable lat:number;\r\n\t//@observable bearing:number;\r\n\t@observable id:string;\r\n\t@observable pmanOffsetY:number;\r\n\t@observable cameraY:number;\r\n    @observable reset:boolean;\r\n\t@observable zoom:number;\r\n\t@observable zoomLock:boolean;\r\n\t@observable panoType:number;\r\n\t@observable typeLock:boolean;\r\n\r\n\tconstructor(lat, lng, cameraY, id){\r\n\t\tthis.lng = lng;\r\n\t\tthis.lat = lat;\r\n\t\t//this.bearing = this.cameraYtoAbsRadian( cameraY );\r\n\t\tthis.id = id;\r\n\t\tthis.cameraY = cameraY;\r\n\t\tthis.pmanOffsetY = this.setPegmanRotationOffsetYFromCameraY(cameraY);\r\n\t\tthis.zoom = 0;\r\n\t\tthis.zoomLock = false;\r\n\t\tthis.panoType = 0;\r\n\t\tthis.typeLock = false;\r\n\t}\r\n\r\n\tupdateValues(lat, lng, cameraY, id){\r\n\t\tthis.lng = lng;\r\n\t\tthis.lat = lat;\r\n\t\t//this.bearing = this.cameraYtoAbsRadian( cameraY );\r\n\t\tthis.id = id;\r\n\t\tthis.cameraY = cameraY;\r\n\t\tthis.pmanOffsetY = this.setPegmanRotationOffsetYFromCameraY(cameraY);\r\n\t}\r\n\r\n\tupdatePegmanOffset(cameraY){\r\n\t\tthis.cameraY = cameraY;\r\n\t\tthis.pmanOffsetY = this.setPegmanRotationOffsetYFromCameraY(cameraY);\r\n\t}\r\n\r\n\tsetPegmanRotationOffsetYFromCameraY(cameraY){\r\n\t\tvar deg = Math.ceil(-cameraY*180/Math.PI);\r\n\t\tif(deg<0){\r\n\t\t\tdeg = 360+deg;\r\n\t\t}\r\n\t\treturn 9+Math.floor(deg/22.5)*60;\r\n\t}\r\n\r\n\tzoomIn(){\r\n\t\tif(this.zoomLock||this.zoom>=maxZoom){\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\tthis.zoom++;\r\n\t}\r\n\r\n\tzoomOut(){\r\n\t\tif(this.zoomLock||this.zoom<=0){\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\tthis.zoom--;\r\n\t}\r\n} ","import * as geolib from 'geolib'\r\nimport api from '../../api/index'\r\n\r\nclass Location {\r\n    //Members\r\n    coord: {\r\n        lat: number,\r\n        lng: number\r\n    } = { lat: 0, lng: 0 }\r\n    calibration: number = 0.0;\r\n    id: string;\r\n    fname: string = \"\";\r\n    neighborhood: string = \"\";\r\n    neighborArr;\r\n    cameraY;\r\n    types:number[];\r\n\r\n    //Methods\r\n    constructor(id: string) {\r\n        this.id = id;\r\n    }\r\n\r\n    setAllAttr = async () => {\r\n        await api.getPanoAllAttrById(this.id).then(result => {\r\n            this.fname = result.data.data.filename;\r\n            this.coord.lat = result.data.data.coord.lat;\r\n            this.coord.lng = result.data.data.coord.lng;\r\n            this.calibration = result.data.data.calibration;\r\n            this.neighborhood = result.data.data.neighborhood;\r\n            this.types = result.data.data.types;\r\n        })\r\n    }\r\n\r\n    getNeighborIds = async () => {\r\n        await api.getNeighborsById(this.id, this.neighborhood).then(result => {\r\n            this.neighborArr = result.data.data;\r\n        })\r\n    }\r\n\r\n    getDistanceTo(loc: Location){\r\n        return geolib.getDistance(this.coord,loc.coord);\r\n    }\r\n\r\n    getDistanceToNeighbors(neighbor: Location[]) {\r\n        return neighbor.map(this.getDistanceTo);\r\n    }\r\n\r\n    getBearingTo(loc: Location) {\r\n        return geolib.getRhumbLineBearing(this.coord, loc.coord);\r\n    }\r\n\r\n    getBearingToNeighbors(neighbor: Location[]) {\r\n        return neighbor.map(this.getBearingTo);\r\n    }\r\n\r\n    updateCalibration = async (camera) => {\r\n        const payload = {\r\n            \"calibration\": -camera.rotation.y\r\n        }\r\n        //await api.updateCalibrationById(this.id,payload).then(res=>{\r\n        alert(\"Update Calibration is disabled at this moment!\");\r\n        //})\r\n    }\r\n}\r\n\r\nexport { Location }\r\n","import * as THREE from 'three'\r\n\r\nclass Cylinder {\r\n  //Members\r\n  mesh: THREE.Mesh\r\n  material: THREE.MeshBasicMaterial\r\n  geometry: THREE.CylinderBufferGeometry\r\n  texture: THREE.Texture\r\n  loader: THREE.TextureLoader\r\n\r\n  constructor() {\r\n    this.geometry = new THREE.CylinderBufferGeometry(20, 20, 15, 100, 1, true)\r\n    this.texture = new THREE.Texture()\r\n    this.loader = new THREE.TextureLoader()\r\n    this.material = new THREE.MeshBasicMaterial()\r\n    this.mesh = new THREE.Mesh(this.geometry, this.material)\r\n  }\r\n\r\n  LoadPanoTexture(fname: string, onComplete: Function) {\r\n    this.texture = this.loader.load(\r\n      process.env.PUBLIC_URL + 'resource/' + fname,\r\n      undefined,\r\n      undefined,\r\n      err => {\r\n        console.error(err)\r\n      }\r\n    )\r\n  }\r\n}\r\n\r\nclass Arrow {\r\n  //Members\r\n  mesh: THREE.Mesh\r\n  material: THREE.MeshBasicMaterial\r\n  geometry\r\n  hitbox\r\n  id: string\r\n\r\n  constructor() {\r\n    this.geometry = new THREE.Geometry()\r\n    this.geometry.vertices.push(\r\n      new THREE.Vector3(0, 0, 0), // 0\r\n      new THREE.Vector3(1.5, -2, 0), // 1\r\n      new THREE.Vector3(1.5, -0.5, 0), // 2\r\n      new THREE.Vector3(0, 1.5, 0), // 3\r\n      new THREE.Vector3(-1.5, -0.5, 0), // 4\r\n      new THREE.Vector3(-1.5, -2, 0) // 5\r\n    )\r\n    this.geometry.faces.push(\r\n      new THREE.Face3(0, 1, 2),\r\n      new THREE.Face3(0, 2, 3),\r\n      new THREE.Face3(4, 0, 3),\r\n      new THREE.Face3(5, 0, 4)\r\n    )\r\n\r\n    this.hitbox = new THREE.Geometry()\r\n    let margin = 0.3;\r\n    this.hitbox.vertices.push(\r\n      new THREE.Vector3(0, 0, 0), // 0\r\n      new THREE.Vector3(1.5+margin, -2-margin, 0), // 1\r\n      new THREE.Vector3(1.5+margin, -0.5+margin, 0), // 2\r\n      new THREE.Vector3(0, 1.5+margin, 0), // 3\r\n      new THREE.Vector3(-1.5-margin, -0.5+margin, 0), // 4\r\n      new THREE.Vector3(-1.5-margin, -2-margin, 0) // 5\r\n    )\r\n    this.hitbox.faces.push(\r\n      new THREE.Face3(0, 1, 2),\r\n      new THREE.Face3(0, 2, 3),\r\n      new THREE.Face3(4, 0, 3),\r\n      new THREE.Face3(5, 0, 4),\r\n      new THREE.Face3(5, 1, 0)\r\n    )\r\n\r\n    //this.material = new THREE.MeshBasicMaterial({color: 'white'})\r\n    //this.mesh = new THREE.Mesh(this.geometry, this.material)\r\n  }\r\n  onClickHandler() {}\r\n}\r\n\r\nexport {Arrow, Cylinder}\r\n","import React from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nconst Rings = styled.div`\r\n\t&,\r\n\t&:after {\r\n\t\tborder-radius: 50%;\r\n\t\twidth: ${({ width = \"48\" }) => width}px;\r\n\t\theight: ${({ width = \"48\" }) => width}px;\r\n\t}\r\n\t& {\r\n\t\tmargin: 60px auto;\r\n\t\tfont-size: 10px;\r\n\t\tposition: relative;\r\n\t\ttext-indent: -9999em;\r\n\t\tborder-top: 1.1em solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-right: 1.1em solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-bottom: 1.1em solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-left: 1.1em solid ${({ color = \"#ea6c2f\" }) => color};\r\n\t\t-webkit-transform: translateZ(0);\r\n\t\t-ms-transform: translateZ(0);\r\n\t\ttransform: translateZ(0);\r\n\t\t-webkit-animation: load8 1.1s infinite linear;\r\n\t\tanimation: load8 1.1s infinite linear;\r\n\t}\r\n\t@-webkit-keyframes load8 {\r\n\t\t0% {\r\n\t\t\t-webkit-transform: rotate(0deg);\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\t-webkit-transform: rotate(360deg);\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\t@keyframes load8 {\r\n\t\t0% {\r\n\t\t\t-webkit-transform: rotate(0deg);\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\t-webkit-transform: rotate(360deg);\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n`;\r\n\r\nexport default Rings;\r\n","import React, { Component, useEffect, useRef } from \"react\";\r\nimport { observable, reaction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport PanoPageStore from \"./pageStore\"\r\n\r\n\r\n@observer\r\nexport default class Compass extends Component<{panoPageStore},{}>{\r\n\r\n    constructor(props){\r\n        super(props);\r\n    }\r\n\r\n    compassRotationReactionDisposer;\r\n    cBaseSrc = require(\"../../assets/viewPano/compassBase.svg\");\r\n    cDiamondSrc = require(\"../../assets/viewPano/compassDiamond.svg\");\r\n    compassElement;\r\n\r\n    componentDidMount(){\r\n        this.setCompassRotationReaction();\r\n        this.compassHandlerInit();\r\n    }\r\n\r\n    compassHandlerInit = () => {\r\n        this.compassElement = document.getElementById(\"compassDiamond\");\r\n        this.compassElement.addEventListener(\"mouseup\", e => this.compassOnClick(e), false);\r\n    }\r\n\r\n    compassOnClick = (e) => {\r\n        e.preventDefault();\r\n        this.props.panoPageStore.reset = true;\r\n    }\r\n\r\n    setCompassRotationReaction() {\r\n        this.compassRotationReactionDisposer = reaction(\r\n            () => this.props.panoPageStore.cameraY,\r\n            (cameraY, reaction) => {\r\n                this.RotateCompass(cameraY);\r\n            }\r\n        );\r\n    }\r\n\r\n    CompassElement = () => {\r\n        return (\r\n            <div>\r\n                <div id=\"compassBase\">\r\n                    <img src={this.cBaseSrc} alt=\"Compass\" />\r\n                </div>\r\n                <div id=\"compassDiamond\">\r\n                    <img src={this.cDiamondSrc} alt=\"Compass\" />\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n\r\n    RotateCompass = (cameraY) => {\r\n        var deg = Math.ceil(-cameraY*180/Math.PI);\r\n\t\tif(deg<0){\r\n\t\t\tdeg = 360+deg;\r\n        }\r\n        document.getElementById(\"compassDiamond\").style.transform = `rotate(${deg}deg)`;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <> \r\n                <this.CompassElement /> \r\n            </>\r\n        )\r\n    }\r\n}","import React, { Component, useEffect, useRef } from \"react\";\r\nimport { observable, reaction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport PanoPageStore from \"./pageStore\"\r\n\r\nconst maxZoom = 2;\r\n\r\n@observer\r\nexport default class ZoomController extends Component<{panoPageStore},{}>{\r\n\r\n    constructor(props){\r\n        super(props);\r\n    }\r\n\r\n    zoomerReactionDisposer;\r\n    zBase = require(\"../../assets/viewPano/zoomerBase.svg\");\r\n    zPlus = require(\"../../assets/viewPano/zoomerPlus.svg\");\r\n    zMinus = require(\"../../assets/viewPano/zoomerMinus.svg\");\r\n    zoomerInElement;\r\n    zoomerOutElement;\r\n    currZoomLevel = 0;\r\n\r\n    componentDidMount(){\r\n        this.zoomerElementHandlerInit();\r\n    }\r\n\r\n    zoomerElementHandlerInit = () => {\r\n        this.zoomerInElement = document.getElementById(\"zoomerIn\");\r\n        this.zoomerOutElement = document.getElementById(\"zoomerOut\");\r\n        this.zoomerInElement.addEventListener(\"mouseup\", e => this.zoomerInOnClick(e), false);\r\n        this.zoomerOutElement.addEventListener(\"mouseup\", e => this.zoomerOutOnClick(e), false);\r\n        this.zoomerInElement.addEventListener(\"mouseover\", e => this.zoomerInOver(e), false);\r\n        this.zoomerOutElement.addEventListener(\"mouseover\", e => this.zoomerOutOver(e), false);\r\n        this.zoomerInElement.addEventListener(\"mouseout\", e => this.zoomerInOut(e), false);\r\n        this.zoomerOutElement.addEventListener(\"mouseout\", e => this.zoomerOutOut(e), false);\r\n    }\r\n\r\n    zoomerInOnClick = (e) => {\r\n        e.preventDefault();\r\n        this.props.panoPageStore.zoomIn();\r\n    }\r\n\r\n    zoomerOutOnClick = (e) => {\r\n        e.preventDefault();\r\n        this.props.panoPageStore.zoomOut();\r\n    }\r\n\r\n    zoomerInOver = (e) => {\r\n        e.preventDefault();\r\n        this.zoomerInElement.style.opacity = 0.5;\r\n    }\r\n\r\n    zoomerOutOver = (e) => {\r\n        e.preventDefault();\r\n        this.zoomerOutElement.style.opacity = 0.5;\r\n    }\r\n\r\n    zoomerInOut = (e) => {\r\n        e.preventDefault();\r\n        this.zoomerInElement.style.opacity = 0.2;\r\n    }\r\n\r\n    zoomerOutOut = (e) => {\r\n        e.preventDefault();\r\n        this.zoomerOutElement.style.opacity = 0.2;\r\n    }\r\n\r\n    ZoomerElement = () => {\r\n        return (\r\n            <div>\r\n                <div id=\"zoomerBase\">\r\n                    <img src={this.zBase} alt=\"Zoom Controller\" />\r\n                    <div id=\"zoomerIn\">\r\n                        <img src={this.zPlus} alt=\"Zoom In\" />\r\n                    </div>\r\n                    <div id=\"zoomerOut\">\r\n                        <img src={this.zMinus} alt=\"Zoom Out\" />\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <> \r\n                <this.ZoomerElement /> \r\n            </>\r\n        )\r\n    }\r\n}","import React, { Component, useEffect, useRef } from \"react\";\r\nimport PropTypes from 'prop-types';\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport { observable, reaction } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport PanoPageStore from \"./pageStore\"\r\nimport { Button, ButtonGroup } from 'reactstrap';\r\n\r\n\r\n@observer\r\nexport default class PanoTypeController extends Component<{panoPageStore},{}>{\r\n\r\n    constructor(props){\r\n        super(props);\r\n    }\r\n\r\n    currPanoType = 0;\r\n    \r\n    changePanoTypeInStore = (type) =>{\r\n        if(this.props.panoPageStore.typeLock)\r\n            return ;\r\n        this.props.panoPageStore.panoType = type;\r\n        this.currPanoType = type;\r\n    }\r\n\r\n    mxOnClick = (e) => {\r\n        e.preventDefault();\r\n        this.changePanoTypeInStore(0);\r\n    }\r\n\r\n    irOnClick = (e) => {\r\n        this.changePanoTypeInStore(1);\r\n        e.preventDefault();\r\n    }\r\n\r\n    panoTypeSelectorElement = () => {\r\n        return (\r\n            <div className=\"typeSelector\">\r\n                <ButtonGroup className=\"buttons\" size=\"lg\">\r\n                    <Button onClick={this.mxOnClick}>Mixed</Button>\r\n                    <Button onClick={this.irOnClick}>Infrared</Button>\r\n                </ButtonGroup>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <> \r\n                <this.panoTypeSelectorElement /> \r\n            </>\r\n        )\r\n    }\r\n}","import React, { Component, useRef } from \"react\";\r\nimport * as THREE from \"three\";\r\nimport { Canvas, useThree, useRender } from \"react-three-fiber\";\r\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\r\n//import SVGLoader from \"three-svg-loader\";\r\nimport { disableBodyScroll } from 'body-scroll-lock';\r\n\r\nimport \"./style/pano.css\";\r\nimport Minimap from \"./components/pano/minimap\"\r\nimport PanoPageStore from \"./components/pano/pageStore\"\r\nimport { Location } from \"./components/pano/location\";\r\nimport { Arrow, Cylinder } from \"./components/pano/shapes\";\r\nimport Spinner from \"./components/spinner\";\r\nimport Compass from \"./components/pano/compass\";\r\nimport ZoomController from \"./components/pano/zoomer\";\r\nimport PanoTypeController from \"./components/pano/panotype\";\r\nimport { observable, reaction } from \"mobx\";\r\nimport { Vector3 } from \"three\";\r\n//import { observer } from \"mobx-react\";\r\n//import OrbitControls from 'three-orbitcontrols'\r\n\r\nconst TWEEN = require(\"@tweenjs/tween.js\");\r\n\r\ninterface PanoProps extends RouteComponentProps<{ id?: string, position? }> {\r\n\tlid: string;\r\n}\r\n\r\ntype PanoState = { \r\n\tisLoading: boolean\r\n};\r\ntype NeighborType = {\r\n\tlocation: Location;\r\n\tdistance: number;\r\n\tbearing: number;\r\n};\r\n\r\nconst zoomLevelFov = {\r\n\t0:40,\r\n\t1:35,\r\n\t2:30\r\n};\r\n\r\nconst PanoTypes = [\"mx\", \"ir\", \"vl\"];\r\n\r\nclass Pano extends Component<PanoProps, PanoState> {\r\n\t//Members\r\n\tcurrLoc: Location;\r\n\tneighbors: Map<string, NeighborType>;\r\n\tpanoPageStore = undefined;\r\n\tpanoIdChangeReactionDisposer;\r\n\tpanoViewDirectionResetReactionDisposer;\r\n\tpanoZoomChangeReactionDisposer;\r\n\tpanoTypeChangeReactionDisposer;\r\n\tcanvasStyle = {cursor:\"default\"};\t\r\n\tloaderSpinnerElem = undefined;\r\n\r\n\t//Flags and locks\r\n\tanimationLock = false;\r\n\twheelLockTemp = false;\r\n\teventListenersLoaded = false;\r\n\tcurrPanoType = 0;\r\n\r\n\t//THREEjs objects\r\n\tcylindergeometry = new THREE.CylinderBufferGeometry(20, 20, 15, 100, 1, true);\r\n\tcylindermaterial = undefined;\r\n\tcylindermesh = undefined;\r\n\ttexture = undefined;\r\n\tloader = new THREE.TextureLoader();\r\n\tlines = [];\r\n\t\r\n    tempcylindergeometry = new THREE.CylinderBufferGeometry(20.1, 20.1, 15, 100, 1, true);\r\n\ttempcylindermaterial = undefined;\r\n\ttempcylindermesh = undefined;\r\n\tthreeCamera = undefined;\r\n\tthreeScene = undefined;\r\n\tthreeCanvas = undefined;\r\n\r\n\tcone0:THREE.Mesh;\r\n\tcone1:THREE.Mesh;\r\n\tcone2:THREE.Mesh;\r\n\r\n\tconevis0:THREE.Mesh;\r\n\tconevis1:THREE.Mesh;\r\n\tconevis2:THREE.Mesh;\r\n\r\n\tconeg0:THREE.Group;\r\n\tconeg1:THREE.Group;\r\n\tconeg2:THREE.Group;\r\n\r\n\tpinSphereGeometry = new THREE.SphereGeometry(0.5,16,16);\r\n\tpinNeedleGeometry = new THREE.CylinderGeometry(0.075, 0.025, 3, 10, 1, false);\r\n\tpin0:THREE.Group;\r\n\tpin1:THREE.Group;\r\n\tpin2:THREE.Group;\r\n\r\n\t//Neighbors\r\n\tn0:NeighborType;\r\n\tn1:NeighborType;\r\n\tn2:NeighborType;\r\n\r\n\tmouseSelectedArrowMesh:THREE.Mesh;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tisLoading: true\r\n\t\t};\r\n\t\tthis.RenderPano = this.RenderPano.bind(this);\r\n\t}\r\n\t\r\n\tget panoId() {\r\n\t\t// @ts-ignore\r\n\t\treturn this.props.match.params.id || \"20190724143833\";\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tdisableBodyScroll(document.querySelector('#interface'));\r\n\t\tvar setCurrLocAndNeighbors = async () => {\r\n\t\t\t//setCurrLoc\r\n\t\t\tthis.currLoc = new Location(this.panoId);\r\n\t\t\t\r\n\t\t\tawait this.currLoc.setAllAttr().then(() => {\r\n\t\t\t\tthis.loadTexture();\r\n\t\t\t});\r\n\t\t\t//setNeighbors\r\n\t\t\tthis.neighbors = new Map();\r\n\t\t\tthis.setNeighbors();\r\n\t\t};\r\n\t\tsetCurrLocAndNeighbors();\r\n\t}\r\n\r\n\tcomponentWillUnmount(){\r\n\t\tconsole.log(\"Unmount pano...\");\r\n\t}\r\n\t\r\n\tasync setNeighbors() {//Only supports two neighbors for now\r\n        this.neighbors.clear();//Purge previous neighbors\r\n\t\tawait this.currLoc.getNeighborIds();\r\n\t\tlet nidArr = this.currLoc.neighborArr;\r\n\t\tif((nidArr as any).length===0){\r\n\t\t\tconsole.log(\"No neighbors discorvered...\");\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tfor(let nid of nidArr as any){\r\n\t\t\t\tlet nextLoc = new Location(nid);\r\n\t\t\t\tawait nextLoc.setAllAttr().then(() => {\r\n\t\t\t\t\tthis.addNeighbor(nextLoc);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\taddNeighbor(n: Location) {\r\n\t\tthis.neighbors.set(n.id, {\r\n\t\t\tlocation: n,\r\n\t\t\tdistance: this.currLoc.getDistanceTo(n),\r\n\t\t\tbearing: this.currLoc.getBearingTo(n)\r\n\t\t});\r\n\t}\r\n\r\n\ttoggleCursor(isPointer){\r\n\t\tif(isPointer){\r\n\t\t\tthis.canvasStyle = {cursor:\"pointer\"}\r\n\t\t}else{\r\n\t\t\tthis.canvasStyle = {cursor:\"default\"}\r\n\t\t}\r\n\t}\r\n\r\n\tsetPanoPageStoreIDChangeReaction() {\r\n\t\tthis.panoIdChangeReactionDisposer = reaction(\r\n\t\t\t() => this.panoPageStore.id,\r\n\t\t\t(id, reaction) => {\r\n\t\t\t\tthis.teleportToScene(id);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tsetCameraResetReaction() {\r\n        this.panoViewDirectionResetReactionDisposer = reaction(\r\n            () => this.panoPageStore.reset,\r\n            (reset, reaction) => {\r\n\t\t\t\tif(reset===true){\r\n\t\t\t\t\tthis.CameraLookNorth(this.threeCamera);\r\n\t\t\t\t}\r\n\t\t\t\tthis.panoPageStore.reset = false;\r\n            }\r\n        );\r\n\t}\r\n\t\r\n\tsetZoomChangeReaction() {\r\n\t\tthis.panoZoomChangeReactionDisposer = reaction(\r\n            () => this.panoPageStore.zoom,\r\n            (zoom, reaction) => {\r\n\t\t\t\tthis.changeZoom();\r\n            }\r\n        );\r\n\t}\r\n\r\n\tsetTypeChangeReaction() {\r\n\t\tthis.panoTypeChangeReactionDisposer = reaction(\r\n            () => this.panoPageStore.panoType,\r\n            (type, reaction) => {\r\n\t\t\t\tthis.changePanoType(type);\r\n            }\r\n        );\r\n\t}\r\n\r\n\tsetAllReactions(){\r\n\t\tthis.setPanoPageStoreIDChangeReaction();\r\n\t\tthis.setCameraResetReaction();\r\n\t\tthis.setZoomChangeReaction();\r\n\t\tthis.setTypeChangeReaction();\r\n\t}\r\n\r\n\tonScroll = (event) => {\r\n\t\tif(this.wheelLockTemp)\r\n\t\t\treturn;\r\n\t\tthis.wheelLockTemp = true;\r\n\t\tif(event.path[0]===this.threeCanvas){\r\n\t\t\tif(event.wheelDeltaY>0){\r\n\t\t\t\tthis.panoPageStore.zoomIn();\r\n\t\t\t}\r\n\t\t\tif(event.wheelDeltaY<0){\r\n\t\t\t\tthis.panoPageStore.zoomOut();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.wheelLockTemp = false;\r\n\t\t/*/// Following code let wheel controls y-axis scene rotation\r\n\t\tif(event.path[0]===canvas){\r\n\t\t\tvar deltaY = event.wheelDeltaY / 3;\r\n\t\t\trotateScene(deltaY);\r\n\t\t}*/\r\n\t}\r\n\r\n\tgeneratePanoFilename(){\r\n\t\tif(this.currLoc.types.includes(this.currPanoType)){\r\n\t\t\treturn `${PanoTypes[this.currPanoType]}/pano-${this.currLoc.id}-${PanoTypes[this.currPanoType]}.png`;\r\n\t\t}else{\r\n\t\t\treturn `mx/pano-${this.currLoc.id}-mx.png`;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tloadTexture() {\r\n\t\tthis.texture = this.loader.load(\r\n\t\t\trequire(`./assets/viewPano/resource/${this.generatePanoFilename()}`),\r\n\t\t\t() => { //On pano first load complete\r\n\t\t\t\tthis.panoPageStore = new PanoPageStore(this.currLoc.coord.lat, this.currLoc.coord.lng, 0.0, this.currLoc.id);\r\n\t\t\t\tthis.setAllReactions();\r\n\t\t\t\tthis.setState({ isLoading: false });\r\n\t\t\t},\r\n\t\t\tundefined,\r\n\t\t\terr => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.cylindermaterial = new THREE.MeshBasicMaterial({\r\n\t\t\tmap: this.texture,\r\n\t\t\tside: THREE.DoubleSide\r\n\t\t});\r\n\t\tthis.cylindermesh = new THREE.Mesh(\r\n\t\t\tthis.cylindergeometry,\r\n\t\t\tthis.cylindermaterial\r\n\t\t);\r\n\t\tthis.cylindergeometry.scale(-1, 1, 1);\r\n\t\t//this.cylindermesh.position.y = 0\r\n        this.cylindermesh.rotation.y = this.currLoc.calibration;\r\n\t}\r\n\t\r\n\r\n\t/*\r\n\tInitNeighborPins() {\r\n\t\tconsole.log(this.lines);\r\n\t\tif (this.lines.length !== 0) {\r\n\t\t\tthis.lines = [];\r\n\t\t}\r\n\t\tthis.neighbors.forEach((loc, id) => {\r\n\t\t\tlet bearing = loc.bearing;\r\n\t\t\tlet line = new THREE.LineBasicMaterial({ color: \"blue\" });\r\n\t\t\tlet geometry = new THREE.Geometry();\r\n\t\t\tgeometry.vertices.push(new THREE.Vector3(0, -5, 0));\r\n\t\t\tgeometry.vertices.push(\r\n\t\t\t\tnew THREE.Vector3(\r\n\t\t\t\t\t20 * Math.sin((bearing * Math.PI) / 180),\r\n\t\t\t\t\t-5,\r\n\t\t\t\t\t-20 * Math.cos((bearing * Math.PI) / 180)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tthis.lines.push(new THREE.Line(geometry, line));\r\n\t\t});\r\n\t}*/\r\n\r\n\tchangeZoom(){\r\n\t\tif(this.animationLock)\r\n\t\t\treturn;\r\n\t\tthis.animationLock = true;\r\n\t\tthis.panoPageStore.zoomLock = true;\r\n\t\tthis.panoZoomChangeReactionDisposer();\r\n\t\tvar zoomBegin = {\r\n\t\t\tat: this.threeCamera.fov\r\n\t\t};\r\n\t\tvar zoomEnd = {\r\n\t\t\tat: zoomLevelFov[ this.panoPageStore.zoom ]\r\n\t\t};\r\n\t\tvar tweenZoom = new TWEEN.Tween(zoomBegin)\r\n\t\t\t.to(zoomEnd, 150)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\ttweenZoom.onUpdate(() => {\r\n\t\t\tthis.threeCamera.fov = zoomBegin.at;\r\n\t\t\tthis.threeCamera.updateProjectionMatrix();\r\n\t\t});\r\n\t\ttweenZoom.onComplete(() => {\r\n\t\t\tthis.setZoomChangeReaction();\r\n\t\t\tthis.animationLock = false;\r\n\t\t\tthis.panoPageStore.zoomLock = false;\r\n\t\t});\r\n\t\ttweenZoom.start();\r\n\t}\r\n\r\n\tchangePanoType(type){\r\n\t\tif(this.animationLock || !this.currLoc.types.includes(this.currPanoType))\r\n\t\t\treturn;\r\n\t\tthis.animationLock = true;\r\n\t\tthis.panoPageStore.typeLock = true;\r\n\t\tthis.panoTypeChangeReactionDisposer();\r\n\t\tthis.loaderSpinnerElem.style.visibility = \"visible\";\r\n\t\tthis.currPanoType = type;\r\n\t\t//console.log(this.generatePanoFilename());\r\n\r\n\t\tthis.texture = this.loader.load(\r\n\t\t\trequire(`./assets/viewPano/resource/${this.generatePanoFilename()}`),\r\n\t\t\t() => {//onComplete\r\n\t\t\t\tthis.loaderSpinnerElem.style.visibility = \"hidden\";\r\n\t\t\t\tthis.setTypeChangeReaction();\r\n\t\t\t\tthis.tempcylindermaterial = new THREE.MeshBasicMaterial({\r\n\t\t\t\t\tmap: this.texture,\r\n\t\t\t\t\tside: THREE.DoubleSide\r\n\t\t\t\t});\r\n\t\t\t\tthis.tempcylindermesh = new THREE.Mesh(\r\n\t\t\t\t\tthis.tempcylindergeometry,\r\n\t\t\t\t\tthis.tempcylindermaterial\r\n\t\t\t\t);\r\n\t\t\t\tthis.tempcylindergeometry.scale(-1, 1, 1);\r\n\t\t\t\tthis.tempcylindermesh.rotation.y = this.cylindermesh.rotation.y;\r\n\t\t\t\tthis.threeScene.add(this.tempcylindermesh);\r\n\t\t\t\tthis.animatePanoTypeChangeTextureFade();\r\n\t\t\t},\r\n\t\t\tundefined,\r\n\t\t\terr => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tanimatePanoTypeChangeTextureFade = () => {\r\n\t\tvar fadeBegin = {\r\n\t\t\tat: this.cylindermaterial.opacity\r\n\t\t};\r\n\t\tvar fadeEnd = {\r\n\t\t\tat: 0.1\r\n\t\t};\r\n\t\tvar crossfade = new TWEEN.Tween(fadeBegin)\r\n\t\t\t.to(fadeEnd, 500)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\tcrossfade.onUpdate(() => {\r\n\t\t\t//console.log(this.cylindermaterial);\r\n\t\t\tthis.cylindermaterial.opacity = fadeBegin.at;\r\n\t\t});\r\n\t\tcrossfade.onComplete( async () => {\r\n\t\t\t//When animations are completed, textures are swapped\r\n\t\t\tthis.cylindermaterial.map = this.texture;\r\n\t\t\tthis.cylindermaterial.transparent = false;\r\n\t\t\tthis.cylindermaterial.opacity = 1.0;\r\n\r\n\t\t\tthis.threeScene.remove(this.tempcylindermesh);\r\n\t\t\tthis.tempcylindermesh.geometry.dispose();\r\n\t\t\tthis.tempcylindermesh.material.dispose();\r\n\t\t\tthis.tempcylindermesh = undefined;\r\n\t\t\tthis.tempcylindergeometry.scale(-1,1,1);\r\n\t\t\tthis.animationLock = false;\r\n\t\t\tthis.panoPageStore.typeLock = false;\r\n\t\t});\r\n\t\tthis.cylindermaterial.transparent = true;\r\n\t\tcrossfade.start();\r\n\t}\r\n\r\n\tCameraLookNorth(camera) {\r\n\t\tif(this.animationLock)\r\n\t\t\treturn;\r\n\t\tthis.animationLock = true;\r\n\t\tthis.panoViewDirectionResetReactionDisposer();\r\n\t\tvar rotBegin = {\r\n\t\t\tat: camera.rotation.y\r\n\t\t};\r\n\t\tvar rotEnd = {\r\n\t\t\tat: 0\r\n\t\t};\r\n\t\tvar tweenRot = new TWEEN.Tween(rotBegin)\r\n\t\t\t.to(rotEnd, 750)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\ttweenRot.onUpdate(() => {\r\n\t\t\tcamera.rotation.y = rotBegin.at;\r\n\t\t\tthis.panoPageStore.updatePegmanOffset(camera.rotation.y);\r\n\t\t});\r\n\t\ttweenRot.onComplete(() => {\r\n\t\t\tcamera.rotation.y = 0;\r\n\t\t\tthis.panoPageStore.updatePegmanOffset(0.0);\r\n\t\t\tthis.setCameraResetReaction();\r\n\t\t\tthis.animationLock = false;\r\n\t\t});\r\n\t\ttweenRot.start();\r\n\t}\r\n\r\n\tteleportToScene = async (id) => {\r\n\t\tthis.animationLock = true;\r\n\t\tthis.loaderSpinnerElem.style.visibility = \"visible\";\r\n\t\t//console.log(\"Teleporting to: \"+id);\r\n\t\tthis.currLoc = new Location(id);\r\n\t\tawait this.currLoc.setAllAttr().then(()=>{\r\n\t\t\tthis.texture = this.loader.load(\r\n\t\t\t\trequire(`./assets/viewPano/resource/${this.generatePanoFilename()}`),\r\n\t\t\t\t() => {//onComplete\r\n\t\t\t\t\tthis.loaderSpinnerElem.style.visibility = \"hidden\";\r\n\t\t\t\t\tthis.tempcylindermaterial = new THREE.MeshBasicMaterial({\r\n\t\t\t\t\t\tmap: this.texture,\r\n\t\t\t\t\t\tside: THREE.DoubleSide\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.tempcylindermesh = new THREE.Mesh(\r\n\t\t\t\t\t\tthis.tempcylindergeometry,\r\n\t\t\t\t\t\tthis.tempcylindermaterial\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis.tempcylindergeometry.scale(-1, 1, 1);\r\n\t\t\t\t\tthis.tempcylindermesh.rotation.y = this.currLoc.calibration;\r\n\t\t\t\t\tthis.threeScene.add(this.tempcylindermesh);\r\n\t\t\t\t\tthis.animateTeleportationTextureFade();\r\n\t\t\t\t\tlet {coord, cameraY, id} = this.currLoc;\r\n\t\t\t\t\tthis.panoPageStore.updateValues(coord.lat, coord.lng, cameraY, id);\r\n\t\t\t\t},\r\n\t\t\t\tundefined,\r\n\t\t\t\terr => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tanimateTeleportationTextureFade = () => {\r\n\t\tvar fadeBegin = {\r\n\t\t\tat: this.cylindermaterial.opacity\r\n\t\t};\r\n\t\tvar fadeEnd = {\r\n\t\t\tat: 0.1\r\n\t\t};\r\n\t\tvar crossfade = new TWEEN.Tween(fadeBegin)\r\n\t\t\t.to(fadeEnd, 500)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\tcrossfade.onUpdate(() => {\r\n\t\t\t//console.log(this.cylindermaterial);\r\n\t\t\tthis.cylindermaterial.opacity = fadeBegin.at;\r\n\t\t});\r\n\t\tcrossfade.onComplete( async () => {\r\n\t\t\t//reset camera zoom and pos\r\n\t\t\tthis.threeCamera.rotation.y = 0;\r\n\t\t\t(this.threeCamera as any).fov = 40;\r\n\t\t\t(this.threeCamera as any).updateProjectionMatrix();\r\n\t\t\t//When animations are completed, textures are swapped\r\n\t\t\t\r\n\t\t\tthis.cylindermaterial.map = this.texture;\r\n\t\t\tthis.cylindermesh.rotation.y = this.currLoc.calibration;\r\n\t\t\tthis.cylindermaterial.transparent = false;\r\n\t\t\tthis.cylindermaterial.opacity = 1.0;\r\n\r\n\t\t\tthis.threeScene.remove(this.tempcylindermesh);\r\n\t\t\tthis.tempcylindermesh.geometry.dispose();\r\n\t\t\tthis.tempcylindermesh.material.dispose();\r\n\t\t\tthis.tempcylindermesh = undefined;\r\n\t\t\tthis.tempcylindergeometry.scale(-1,1,1);\r\n\t\t\tawait this.setNeighbors().then(this.RenderArrows);\r\n\t\t\tthis.animationLock = false;\r\n\t\t});\r\n\t\tthis.cylindermaterial.transparent = true;\r\n\t\tcrossfade.start();\r\n\t}\r\n\r\n\tRenderSpinner = () => {\r\n\t\treturn (\r\n\t\t\t<div className={\"spinner-container\"}>\r\n\t\t\t\t<Spinner width={100} height={100} />\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\r\n\tRenderArrows = () => {\r\n\t\tvar iter = this.neighbors.keys();\r\n\t\t//iter.next();\r\n\t\tthis.n0 = this.neighbors.get(iter.next().value);\r\n\t\tconsole.log(this.currLoc.id);\r\n\t\tlet arrowSpacing = 7.5;\r\n\t\t//position\r\n\t\tthis.cone0.position.z = - arrowSpacing * Math.cos(this.n0.bearing * Math.PI / 180);\r\n\t\tthis.cone0.position.x = arrowSpacing * Math.sin(this.n0.bearing * Math.PI / 180);\r\n\t\t//rotation\r\n\t\tthis.cone0.rotation.x = -1.5708;\r\n\t\tthis.cone0.rotation.z = (-this.n0.bearing) * Math.PI / 180;\r\n\t\t//position\r\n\t\tthis.conevis0.position.z = - arrowSpacing * Math.cos(this.n0.bearing * Math.PI / 180);\r\n\t\tthis.conevis0.position.x = arrowSpacing * Math.sin(this.n0.bearing * Math.PI / 180);\r\n\t\t//rotation\r\n\t\tthis.conevis0.rotation.x = -1.5708;\r\n\t\tthis.conevis0.rotation.z = (-this.n0.bearing) * Math.PI / 180;\r\n\t\t\r\n\t\tthis.coneg1.visible = false;\r\n\t\tthis.coneg2.visible = false;\r\n\t\t//this.cone0.geometry.computeBoundingSphere();\r\n\t\t\r\n\t\tif (this.neighbors.size > 1) {\r\n\t\t\tthis.n1 = this.neighbors.get(iter.next().value);\r\n\t\t\tthis.coneg1.visible = true;\r\n\t\t\t//position\r\n\t\t\tthis.cone1.position.z = -arrowSpacing * Math.cos(this.n1.bearing * Math.PI / 180);\r\n\t\t\tthis.cone1.position.x = arrowSpacing * Math.sin(this.n1.bearing * Math.PI / 180);\r\n\t\t\t//rotation\r\n\t\t\tthis.cone1.rotation.x = -1.5708;\r\n\t\t\tthis.cone1.rotation.z = (-this.n1.bearing) * Math.PI / 180;\r\n\t\t\t//position\r\n\t\t\tthis.conevis1.position.z = - arrowSpacing * Math.cos(this.n1.bearing * Math.PI / 180);\r\n\t\t\tthis.conevis1.position.x = arrowSpacing * Math.sin(this.n1.bearing * Math.PI / 180);\r\n\t\t\t//rotation\r\n\t\t\tthis.conevis1.rotation.x = -1.5708;\r\n\t\t\tthis.conevis1.rotation.z = (-this.n1.bearing) * Math.PI / 180;\r\n\t\t\t//console.log(this.cone1.rotation.z);\r\n\t\t\t//this.cone1.geometry.computeBoundingSphere();\r\n\t\t\t//console.log(this.cone1.localToWorld(this.cone1.geometry.boundingSphere.center));\r\n\t\t}\r\n\t\tif(this.neighbors.size===3){\r\n\t\t\tthis.n2 = this.neighbors.get(iter.next().value);\r\n\t\t\tthis.coneg2.visible = true;\r\n\t\t\t//position\r\n\t\t\tthis.cone2.position.z = -arrowSpacing * Math.cos(this.n2.bearing * Math.PI / 180);\r\n\t\t\tthis.cone2.position.x = arrowSpacing * Math.sin(this.n2.bearing * Math.PI / 180);\r\n\t\t\t//rotation\r\n\t\t\tthis.cone2.rotation.x = -1.5708;\r\n\t\t\tthis.cone2.rotation.z = (-this.n2.bearing) * Math.PI / 180;\r\n\t\t\t//position\r\n\t\t\tthis.conevis2.position.z = - arrowSpacing * Math.cos(this.n2.bearing * Math.PI / 180);\r\n\t\t\tthis.conevis2.position.x = arrowSpacing * Math.sin(this.n2.bearing * Math.PI / 180);\r\n\t\t\t//rotation\r\n\t\t\tthis.conevis2.rotation.x = -1.5708;\r\n\t\t\tthis.conevis2.rotation.z = (-this.n2.bearing) * Math.PI / 180;\r\n\t\t\t//this.cone2.geometry.computeBoundingSphere();\r\n\t\t\t//console.log(this.cone2.rotation.z);\r\n\t\t}\r\n\t}\r\n\r\n\tRenderPano() {\r\n\t\tthis.loaderSpinnerElem = document.getElementById(\"trans-spinner\");\r\n\t\tlet { gl, camera, scene, canvas, raycaster } = useThree();\r\n\t\t//var canvas = gl.domElement;  // for react-three-fiber v3.x\r\n\t\tthis.threeCamera = camera;\r\n\t\tthis.threeScene = scene;\r\n\t\tthis.threeCanvas = canvas;\r\n\t\t\r\n\t\t(camera as any).fov = 40;\r\n\t\t//gl.setSize(window.innerWidth, window.innerHeight);\r\n\t\tgl.setSize(canvas.clientWidth, canvas.clientHeight);\r\n\t\t\r\n\t\tcamera.position.set(0, 0, 0.0);\r\n\t\tcamera.lookAt(0, 0, 0);\r\n\r\n\t\tlet cone = new Arrow();\r\n\t\tlet conemesh = useRef();\r\n\t\tlet conemesh1 = useRef();\r\n\t\tlet conemesh2 = useRef();\r\n\t\t//var mousedir = useRef();\r\n\t\tlet compassPlate = useRef();\r\n\r\n\t\tthis.cone0 = conemesh.current as any;\r\n\t\tthis.cone1 = conemesh1.current as any;\r\n\t\tthis.cone2 = conemesh2.current as any;\r\n\r\n\t\tlet coneVisible0 = useRef<THREE.Mesh>();\r\n\t\tthis.conevis0 = coneVisible0.current;\r\n\t\tlet coneVisible1 = useRef<THREE.Mesh>();\r\n\t\tthis.conevis1 = coneVisible1.current;\r\n\t\tlet coneVisible2 = useRef<THREE.Mesh>();\r\n\t\tthis.conevis2 = coneVisible2.current;\r\n\r\n\t\tlet conegroup0 = useRef<THREE.Group>();\r\n\t\tthis.coneg0 = conegroup0.current;\r\n\t\tlet conegroup1 = useRef<THREE.Group>();\r\n\t\tthis.coneg1 = conegroup1.current;\r\n\t\tlet conegroup2 = useRef<THREE.Group>();\r\n\t\tthis.coneg2 = conegroup2.current;\r\n\r\n\r\n\t\tlet c0Sphere;\r\n\t\tlet c1Sphere;\r\n\t\tlet c2Sphere;\r\n\t\tlet coneBoundingSpheres = [c0Sphere, c1Sphere, c2Sphere];\r\n\r\n\t\tlet mouse = { x: 0, y: 0 };\r\n\t\tlet arrow = new Arrow();\r\n\t\tlet mouseplateG = useRef();\r\n\t\tlet showMousePlate = true;\r\n\t\tlet isAnimating = false;\r\n\t\tlet isDraggin = false;\r\n\t\r\n\t\tlet rcObjects = [];\r\n\r\n\t\tlet planegeo = new THREE.PlaneGeometry(40, 40);\r\n\t\tlet planemat = new THREE.MeshBasicMaterial({ color: \"grey\", side: THREE.DoubleSide, opacity:0.0, transparent:true });\r\n\t\tlet rcplane = new THREE.Mesh(planegeo, planemat); //not a remotely-controlled plane, but a mathematical plane that involves in raycast\r\n\t\trcplane.rotation.set(-1.5708, 0, 0);\r\n\t\trcplane.position.set(0,-1,0);\r\n\t\tscene.add(rcplane);\r\n\t\t\r\n\t\tlet getInitialConeBoundingSpheres = () => {\r\n\t\t\tthis.cone0.geometry.computeBoundingSphere();\r\n\t\t\tthis.cone1.geometry.computeBoundingSphere();\r\n\t\t\tthis.cone2.geometry.computeBoundingSphere();\r\n\t\t\tc0Sphere = this.cone0.geometry.boundingSphere;\r\n\t\t\tc1Sphere = this.cone1.geometry.boundingSphere;\r\n\t\t\tc2Sphere = this.cone2.geometry.boundingSphere;\r\n\r\n\t\t}\r\n\r\n\t\tif (this.cone0 && this.cone1 && this.cone2 && compassPlate.current) {\r\n\t\t\t//getInitialConeBoundingSpheres();\r\n\t\t\t/*rcObjects.push(c0Sphere);\r\n\t\t\trcObjects.push(c1Sphere);\r\n\t\t\trcObjects.push(c2Sphere);*/\r\n\t\t\trcObjects.push(this.cone0);\r\n\t\t\trcObjects.push(this.cone1);\r\n\t\t\trcObjects.push(this.cone2);\r\n\t\t\t//rcObjects.push(compassPlate.current);\r\n\t\t\trcObjects.push(rcplane);\r\n\t\t\t//rcObjects.push(compassGroup.current);\r\n\t\t}\r\n\r\n\t\tlet bsphere = useRef();\r\n\t\tif(bsphere.current){\r\n\t\t\tthis.cone0.geometry.computeBoundingSphere();\r\n\t\t\tlet center1 = this.cone0.geometry.boundingSphere.center;\r\n\t\t\tlet v1 = new Vector3(center1.x,center1.y,center1.z);\r\n\t\t\t//@ts-ignore\r\n\t\t\tconeGroup.current.localToWorld(v1);\r\n\t\t}\r\n\r\n\t\tvar distanceToArrowInWorldCoord = (mesh, index) => {\r\n\t\t\t(mouseplateG.current as any).children[1].geometry.computeBoundingSphere();\r\n\t\t\tlet center0 = (mouseplateG.current as any).children[1].geometry.boundingSphere.center;\r\n\t\t\tlet v0 = new Vector3(center0.x,center0.y,center0.z);\r\n\t\t\t(mouseplateG.current as any).localToWorld(v0);\r\n\r\n\t\t\tmesh.geometry.computeBoundingSphere();\r\n\t\t\tconeBoundingSpheres[index] = mesh.geometry.boundinSphere;\r\n\t\t\tlet center1 = mesh.geometry.boundingSphere.center;\r\n\t\t\tlet v1 = new Vector3(center1.x,center1.y,center1.z);\r\n\t\t\tmesh.localToWorld(v1);\r\n\t\t\t\r\n\t\t\treturn v0.distanceTo(v1);\r\n\t\t}\r\n\r\n\t\tvar getClosestArrowAndAdjustDirection = () => {\r\n\t\t\tif(!mouseplateG.current)\r\n\t\t\t\treturn;\r\n\t\t\tlet arr = [this.cone0, this.cone1, this.cone2];\r\n\t\t\tlet dist = new Map<number, THREE.Mesh>();\r\n\t\t\tfor(let i=0; i<arr.length; i++){\r\n\t\t\t\tif(!arr[i].parent.visible){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tdist.set( distanceToArrowInWorldCoord(arr[i], i), arr[i] );\r\n\t\t\t}\r\n\t\t\tlet min = Math.min(...dist.keys());\r\n\t\t\t(mouseplateG.current as any).rotation.z = dist.get(min).rotation.z;\r\n\t\t\tthis.mouseSelectedArrowMesh = dist.get(min);\r\n\t\t}\r\n\r\n\t\tvar navigateWithMouse = () => {\r\n\t\t\tlet nArr = [this.n0, this.n1, this.n2];\r\n\t\t\tlet id = nArr[this.mouseSelectedArrowMesh.userData.neighbor].location.id;\r\n\t\t\ttransitionToScene(id);\r\n\t\t}\r\n\r\n\t\tvar onMouseMove2 = ( event ) => {\r\n\t\t\tif(mouseDown) return;\r\n\t\t\tif(mouseplateG.current){\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tmouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n\t\t\t\tmouse.y = - (event.clientY / window.innerHeight) * 2 + 1;\r\n\t\t\t\traycaster.setFromCamera(mouse, camera);\r\n\t\t\t\tvar intersects = raycaster.intersectObjects(rcObjects);\r\n\t\t\t\tif (intersects.length > 0) {\r\n\t\t\t\t\tvar intersect = intersects[0];\r\n\t\t\t\t\t//console.log( intersects[ 0 ]);\r\n\t\t\t\t\tif( intersects.length === 1 ){//intersect.object===rcplane){\r\n\t\t\t\t\t\t//console.log(compassGroup.current);\r\n\t\t\t\t\t\t(mouseplateG.current as any).visible = true;\r\n\t\t\t\t\t\t(mouseplateG.current as any).position.copy(intersect.point).add(new THREE.Vector3(0, 0.01, 0));\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t(mouseplateG.current as any).visible = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Mouse drag rotation controls\r\n\t\tvar mouseDown = false,\r\n\t\t\tmouseX = 0,\r\n\t\t\tmouseY = 0;\r\n\r\n\t\tfunction onMouseMove(evt) {\r\n\t\t\tif (mouseDown) {\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\tvar deltaX = evt.clientX - mouseX,\r\n\t\t\t\t\tdeltaY = evt.clientY - mouseY;\r\n\t\t\t\tmouseX = evt.clientX;\r\n\t\t\t\tmouseY = evt.clientY;\r\n\r\n\t\t\t\trotateScene(deltaX);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction onMouseDown(evt) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tmouseDown = true;\r\n\t\t\tmouseX = evt.clientX;\r\n\t\t\tmouseY = evt.clientY;\r\n\t\t}\r\n\r\n\t\tfunction onMouseUp(evt) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tmouseDown = false;\r\n\t\t\tisDraggin = false;\r\n\t\t}\r\n\r\n\t\t//Touch rotation control\r\n\t\tvar startX = 0;\r\n\r\n\t\tfunction onTouchStart(event) {\r\n\t\t\tstartX = (event.targetTouches[0].pageX);\r\n\t\t}\r\n\r\n\t\tfunction onTouchMove(event) {\r\n\t\t\tvar deltaX = (event.targetTouches[0].pageX - startX);\r\n\t\t\tstartX = (event.targetTouches[0].pageX);\r\n\t\t\trotateScene(deltaX);\r\n\t\t}\r\n        \r\n\t\tvar rotateScene = (deltaX) => {\r\n\t\t\tif(this.animationLock)\r\n\t\t\t\treturn;\r\n\t\t\tif(deltaX!==0){\r\n\t\t\t\tisDraggin = true;\r\n\t\t\t}\r\n\t\t\tcamera.rotation.y += deltaX / 1000;\r\n\t\t\tcamera.rotation.y %= 2 * Math.PI;\r\n\t\t\tthis.panoPageStore.updatePegmanOffset(camera.rotation.y);\r\n\t\t}\r\n\t\t\r\n\t\tfunction onWindowResize(){\r\n\t\t\tgl.setSize(canvas.clientWidth, canvas.clientHeight);\r\n\t\t\t(camera as any).aspect = canvas.clientWidth / canvas.clientHeight;\r\n\t\t\t(camera as any).updateProjectionMatrix();\r\n\t\t}\r\n\r\n\r\n\t\twindow.addEventListener('mousemove', onMouseMove2, false);\r\n\t\tcanvas.addEventListener(\"mousemove\", e => onMouseMove(e), false);\r\n\t\tcanvas.addEventListener(\"mousedown\", e => onMouseDown(e), false);\r\n\t\tcanvas.addEventListener(\"mouseup\", e => onMouseUp(e), false);\r\n\r\n\t\tcanvas.addEventListener(\"touchmove\", e => onTouchMove(e), false);\r\n\t\tcanvas.addEventListener(\"touchstart\", e => onTouchStart(e), false);\r\n\t\twindow.addEventListener('resize', onWindowResize, false);\r\n\r\n\r\n\t\tif (!this.eventListenersLoaded) {\r\n\t\t\tcanvas.addEventListener(\"mousewheel\", e => this.onScroll(e), false);\r\n\t\t\tthis.eventListenersLoaded = true;\r\n\t\t}\r\n\r\n\t\tvar animateTransition = id => {\r\n\t\t\t(mouseplateG.current as any).visible = false;\r\n\t\t\tisAnimating = true;\r\n            //Set up parameters for TWEEN animations\r\n\t\t\tconst depth = 13;\r\n\t\t\tconst resFov = 65;\r\n\t\t\tconst camAt = (this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\tvar endAt = (-this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\tif (camera.rotation.y > 0) {\r\n\t\t\t\tendAt = 2 * Math.PI - (this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\t}\r\n\t\t\tif(camera.rotation.y-endAt >= Math.PI && camera.rotation.y-endAt<2*Math.PI){\r\n\t\t\t\tendAt += 2 * Math.PI; \r\n\t\t\t}else if( camera.rotation.y-endAt <= -Math.PI && camera.rotation.y-endAt< -2*Math.PI){\r\n\t\t\t\tendAt = - 2 * Math.PI + endAt;\r\n\t\t\t}\r\n\t\t\tvar rotBegin = {\r\n\t\t\t\tat: (camera as any).rotation.y\r\n\t\t\t};\r\n\t\t\tvar rotEnd = {\r\n\t\t\t\tat: endAt\r\n\t\t\t};\r\n\t\t\tvar tweenRot = new TWEEN.Tween(rotBegin)\r\n\t\t\t\t.to(rotEnd, 500)\r\n\t\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\t\t//console.log(\"begin: \",rotBegin,\" end: \",rotEnd);\r\n\t\t\ttweenRot.onUpdate(() => {\r\n\t\t\t\t(camera as any).rotation.y = rotBegin.at;\r\n\t\t\t\tthis.panoPageStore.updatePegmanOffset(camera.rotation.y);\r\n\t\t\t\t//console.log(this.threeCamera.rotation.y);\r\n\t\t\t});\r\n\t\t\ttweenRot.onComplete(() => {\r\n\t\t\t\tcamera.rotation.y = (-this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\t\tthis.panoPageStore.updatePegmanOffset(camera.rotation.y);\r\n\t\t\t});\r\n\r\n\t\t\tvar zoom = {\r\n\t\t\t\tzVal: (camera as any).position.z,\r\n\t\t\t\txVal: (camera as any).position.x,\r\n                fovValue: (camera as any).fov,\r\n                opacity: this.cylindermaterial.opacity\r\n\t\t\t};\r\n\t\t\tvar zoomEnd = {\r\n\t\t\t\tzVal: -depth * Math.cos(camAt),\r\n\t\t\t\txVal: depth * Math.sin(camAt),\r\n                fovValue: resFov,\r\n                opacity: 0.1\r\n\t\t\t};\r\n\t\t\tvar tweenZoom = new TWEEN.Tween(zoom).to(zoomEnd, 500);\r\n\r\n\t\t\ttweenZoom.onUpdate(() => {\r\n\t\t\t\t(camera as any).position.z = zoom.zVal;\r\n\t\t\t\t(camera as any).position.x = zoom.xVal;\r\n\t\t\t\t(camera as any).fov = zoom.fovValue;\r\n                (camera as any).updateProjectionMatrix();\r\n                this.cylindermaterial.opacity = zoom.opacity;\r\n\t\t\t});\r\n\t\t\ttweenZoom.onComplete(async () => {\r\n                //reset camera zoom and pos\r\n                camera.position.set(0,0,0);\r\n\t\t\t\t(camera as any).fov = 40;\r\n                (camera as any).updateProjectionMatrix();\r\n                //When animations are completed, textures are swapped\r\n                \r\n                this.cylindermaterial.map = this.texture;\r\n                this.cylindermesh.rotation.y = this.currLoc.calibration;\r\n                this.cylindermaterial.transparent = false;\r\n                this.cylindermaterial.opacity = 1.0;\r\n\t\t\t\t//console.log(\"b1\");\r\n                scene.remove(this.tempcylindermesh);\r\n                this.tempcylindermesh.geometry.dispose();\r\n                this.tempcylindermesh.material.dispose();\r\n                this.tempcylindermesh = undefined;\r\n\t\t\t\tthis.tempcylindergeometry.scale(-1,1,1);\r\n\t\t\t\tisAnimating = false;\r\n\t\t\t\t(mouseplateG.current as any).visible = true;\r\n\t\t\t\tawait this.setNeighbors().then(this.RenderArrows);//.then(()=>{this.InitNeighborPins()});\r\n\t\t\t\tthis.animationLock = false;\r\n\t\t\t\t//console.log(\"b2\");\r\n\t\t\t});\r\n            tweenRot.chain(tweenZoom);\r\n            this.cylindermaterial.transparent = true;\r\n            \r\n\t\t\ttweenRot.start();\r\n\t\t};\r\n        \r\n        scene.add(this.cylindermesh);\r\n\t\t//RenderCompass();\r\n\r\n\t\tvar transitionToScene = async (pid) => {\r\n\t\t\tthis.animationLock = true;\r\n\t\t\tthis.loaderSpinnerElem.style.visibility = \"visible\";\r\n\t\t\tthis.panoIdChangeReactionDisposer();\r\n\t\t\tif(!this.neighbors.get(pid)){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.currLoc = this.neighbors.get(pid).location;\r\n\t\t\t//await this.currLoc.setAllAttr();\r\n\t\t\tthis.texture = this.loader.load(\r\n\t\t\t\trequire(`./assets/viewPano/resource/${this.generatePanoFilename()}`),\r\n\t\t\t\t() => {//onComplete\r\n\t\t\t\t\tthis.loaderSpinnerElem.style.visibility = \"hidden\";\r\n                    this.tempcylindermaterial = new THREE.MeshBasicMaterial({\r\n                        map: this.texture,\r\n                        side: THREE.DoubleSide\r\n                    });\r\n                    this.tempcylindermesh = new THREE.Mesh(\r\n                        this.tempcylindergeometry,\r\n                        this.tempcylindermaterial\r\n                    );\r\n                    this.tempcylindergeometry.scale(-1, 1, 1);\r\n                    this.tempcylindermesh.rotation.y = this.currLoc.calibration;\r\n\t\t\t\t\tscene.add(this.tempcylindermesh);\r\n\t\t\t\t\t//console.log(\"a\");\r\n\t\t\t\t\tanimateTransition(pid);\r\n\t\t\t\t\t//console.log(\"c\");\r\n\t\t\t\t\tlet {coord, cameraY, id} = this.currLoc;\r\n\t\t\t\t\tthis.panoPageStore.updateValues(coord.lat, coord.lng, cameraY, id);\r\n\t\t\t\t\tthis.setPanoPageStoreIDChangeReaction();\r\n\t\t\t\t},\r\n\t\t\t\tundefined,\r\n\t\t\t\terr => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\t\t\r\n        if(this.cone0 && this.cone1 && this.cone2){\r\n\t\t\tthis.RenderArrows();\r\n        }\r\n\t\tvar coneGroup = useRef();\r\n\t\tvar compassGroup = useRef();\r\n\t\tvar triGeo = useRef();\r\n\t\tlet triGeoArr = [new THREE.Vector3(0, 1, 0), new THREE.Vector3(-0.6, -1, 0), new THREE.Vector3(0, -0.5, 0), new THREE.Vector3(0.6, -1, 0)];\r\n\t\tif (triGeo.current){\r\n\t\t\t(triGeo.current as any).vertices = triGeoArr;\r\n\t\t\t(triGeo.current as any).faces.push( new THREE.Face3( 0, 1, 2 ) );\r\n\t\t\t(triGeo.current as any).faces.push( new THREE.Face3( 0, 2, 3 ) );\r\n\t\t\t(triGeo.current as any).computeFaceNormals();\r\n\t\t\t(triGeo.current as any).scale(0.3, 0.3, 0.3);\r\n\t\t}\r\n\t\tfunction setChildrenOpacity(group, opc){\r\n\t\t\tfor(let child of group){\r\n\t\t\t\tchild.material.opacity = opc;\r\n\t\t\t}\r\n        }\r\n        \r\n        var testMesh = useRef();\r\n        if(testMesh.current){\r\n            (testMesh.current as any).geometry.scale(2,2,2);\r\n\t\t}\r\n\r\n\t\tuseRender(() => {\r\n\t\t\tTWEEN.update();\r\n\t\t\t(coneGroup.current as any).position.set(\r\n\t\t\t\t-3 * Math.sin(camera.rotation.y),\r\n\t\t\t\t-0.9,\r\n\t\t\t\t-3 * Math.cos(camera.rotation.y)\r\n\t\t\t);\r\n\t\t\t(compassGroup.current as any).position.set(\r\n\t\t\t\t-3 * Math.sin(camera.rotation.y-0.4),\r\n\t\t\t\t-0.8,\r\n\t\t\t\t-3 * Math.cos(camera.rotation.y-0.4)\r\n\t\t\t);\r\n\t\t\t(compassGroup.current as any).rotation.y=camera.rotation.y;\r\n\t\t\t(compassGroup.current as any).rotation.z=-camera.rotation.y;\r\n\t\t\t\r\n\t\t\tgetClosestArrowAndAdjustDirection();\r\n\t\t\t\r\n\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<group /*group of arrows */\r\n\r\n\t\t\t\t\tref={coneGroup}\r\n\t\t\t\t\tscale={[0.2, 0.2, 0.2]}\r\n\t\t\t\t>\r\n\t\t\t\t\t<group //-----------------FIRST ARROW -------------------//\r\n\t\t\t\t\t\tonPointerOver={e => {setChildrenOpacity(e.object.children, 0.9); this.toggleCursor(true);}}\r\n\t\t\t\t\t\tonPointerOut={e => {setChildrenOpacity(e.object.children, 0.65); this.toggleCursor(false);}}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tref={conegroup0}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<mesh //First Arrow Hitbox\r\n\t\t\t\t\t\t\tuserData={{ neighbor: 0 }}\r\n\t\t\t\t\t\t\tref={conemesh}\r\n\t\t\t\t\t\t\tgeometry={cone.hitbox}\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tif(!this.animationLock){\r\n\t\t\t\t\t\t\t\t\ttransitionToScene(this.n0.location.id); /*this.currLoc.updateCalibration(camera)*/\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"blue\" opacity={0.5} transparent={true} visible={false} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t\t<mesh //First Arrow Visible\r\n\t\t\t\t\t\t\tgeometry={cone.geometry}\r\n\t\t\t\t\t\t\tref={coneVisible0}\r\n\t\t\t\t\t\t> \r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.65} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t</group>\r\n\t\t\t\t\t<group //----------------SECOND ARROW ------------------------//\r\n\t\t\t\t\t\tonPointerOver={e => {setChildrenOpacity(e.object.children, 0.9); this.toggleCursor(true);}}\r\n\t\t\t\t\t\tonPointerOut={e => {setChildrenOpacity(e.object.children, 0.65); this.toggleCursor(false);}}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tref={conegroup1}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<mesh //Second Arrow Hitbox\r\n\t\t\t\t\t\t\tuserData={{ neighbor: 1 }}\r\n\t\t\t\t\t\t\tref={conemesh1}\r\n\t\t\t\t\t\t\tgeometry={cone.hitbox}\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tif(!this.animationLock){\r\n\t\t\t\t\t\t\t\t\ttransitionToScene(this.n1.location.id); /*this.currLoc.updateCalibration(camera)*/\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"blue\" opacity={0.5} transparent={true} visible={false} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t\t<mesh //Second Arrow Visible\r\n\t\t\t\t\t\t\tgeometry={cone.geometry}\r\n\t\t\t\t\t\t\tref={coneVisible1}\r\n\t\t\t\t\t\t> \r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.65} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t</group>\r\n\t\t\t\t\t<group //-----------------THIRD ARROW ----------------------- //\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tonPointerOver={e => {setChildrenOpacity(e.object.children, 0.9); this.toggleCursor(true);}}\r\n\t\t\t\t\t\tonPointerOut={e => {setChildrenOpacity(e.object.children, 0.65); this.toggleCursor(false);}}\r\n\t\t\t\t\t\tref={conegroup2}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<mesh //Third Arrow Hitbox\r\n\t\t\t\t\t\t\tuserData={{ neighbor: 2 }}\r\n\t\t\t\t\t\t\tref={conemesh2}\r\n\t\t\t\t\t\t\tgeometry={cone.hitbox}\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tif(!this.animationLock){\r\n\t\t\t\t\t\t\t\t\ttransitionToScene(this.n2.location.id);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"blue\" opacity={0.5} transparent={true} visible={false} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t\t<mesh //Second Arrow Visible\r\n\t\t\t\t\t\t\tgeometry={cone.geometry}\r\n\t\t\t\t\t\t\tref={coneVisible2}\r\n\t\t\t\t\t\t> \r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.65} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t</group>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t</group>\r\n\t\t\t\t<group\r\n\t\t\t\t\tonPointerOver={e => {setChildrenOpacity(e.object.children, 0.8); this.toggleCursor(true);}}\r\n\t\t\t\t\tonPointerOut={e => {setChildrenOpacity(e.object.children, 0.5); this.toggleCursor(false);}}\r\n\t\t\t\t\tref={compassGroup}\r\n\t\t\t\t\tposition={[0,0,-3]}\r\n\t\t\t\t\tscale={[0.3, 0.3, 0.3]}\r\n\t\t\t\t\tvisible={false}\r\n\t\t\t\t>\r\n\t\t\t\t\t<mesh //Compass Plate \r\n\t\t\t\t\t\t//onClick={() => this.CameraLookNorth(camera)}\r\n\t\t\t\t\t\tgeometry={new THREE.CircleGeometry(0.4, 100, 0)}\r\n\t\t\t\t\t\tref={compassPlate}\t\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.5} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t\t<mesh //Compass North Arrow \r\n\t\t\t\t\t\tposition={[0, 0.03, 0.01]}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<geometry\r\n\t\t\t\t\t\t\tattach=\"geometry\"\r\n\t\t\t\t\t\t\tref={triGeo}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"red\" opacity={0.5} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t</group>\r\n\r\n\t\t\t\t<group\r\n\t\t\t\t\tref={mouseplateG}\r\n\t\t\t\t\trotation={[-1.5708, 0, 0]}\r\n\t\t\t\t\t\r\n\t\t\t\t>\r\n\t\t\t\t\t<mesh\r\n\t\t\t\t\t\tgeometry={arrow.geometry}\r\n\t\t\t\t\t\tposition={[0, 0.05, 0.001]}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tscale={[0.2, 0.12, 0.2]}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"grey\" opacity={0.7} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t\t<mesh\r\n\t\t\t\t\t\tgeometry={new THREE.CircleGeometry(0.4, 100, 0)}\r\n\t\t\t\t\t\tonPointerUp={()=>{if(!isDraggin && !this.animationLock){ navigateWithMouse(); }}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.7} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t</group>\r\n\r\n\t\t\t\t{/*<group\r\n\t\t\t\t\tref={pinGroup}\r\n\t\t\t\t\tposition={[-7, 0.1, -7]}\r\n\t\t\t\t\tscale={[0.5,0.5,0.5]}\r\n\t\t\t\t>\r\n\t\t\t\t\t<group\r\n\t\t\t\t\t\tref={ping0}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<mesh\r\n\t\t\t\t\t\t\tgeometry={this.pinNeedleGeometry}\r\n\t\t\t\t\t\t\tposition={[0, -2, 0]}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.75} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t\t<mesh\r\n\t\t\t\t\t\t\tgeometry={this.pinSphereGeometry}\r\n\t\t\t\t\t\t\tposition={[0, 0, 0]}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"red\" opacity={0.75} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t</group>\r\n\t\t\t\t</group>*/}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\t//TODO: change the pano window render size\r\n\trender() {\r\n\t\tconst { isLoading } = this.state;\r\n\t\treturn isLoading ? (\r\n\t\t\t<div className={\"spinner-container\"}>\r\n\t\t\t\t<Spinner width={100} height={100} />\r\n\t\t\t</div>\r\n\t\t) : (\r\n\t\t\t\t<div className=\"Pano-container\">\r\n\t\t\t\t\t<div className=\"Pano-canvas\" style={this.canvasStyle}>\r\n\t\t\t\t\t\t<Canvas>\r\n\t\t\t\t\t\t\t<this.RenderPano />\r\n\t\t\t\t\t\t</Canvas>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<Minimap panoPageStore={this.panoPageStore} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div><Compass panoPageStore={this.panoPageStore} /></div>\r\n\t\t\t\t\t<div><ZoomController panoPageStore={this.panoPageStore} /></div>\r\n\t\t\t\t\t<div><PanoTypeController panoPageStore={this.panoPageStore} /></div>\r\n\t\t\t\t\t<div id=\"trans-spinner\" style={ {visibility:\"hidden\"} }>\r\n\t\t\t\t\t\t<this.RenderSpinner />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t}\r\n}\r\n\r\nexport default withRouter(Pano);\r\n","import React, {Component, useRef} from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport {HashRouter as Router, Route, Switch, NavLink, Redirect} from 'react-router-dom'\r\nimport { observable, reaction } from \"mobx\";\r\nimport {Container, Header, Content} from './components/layout'\r\nimport GMap from './maps'\r\nimport Pano from './pano'\r\nimport './style/App.css'\r\n\r\nconst routes = [\r\n  {\r\n    path: '/maps/boston',\r\n    title: 'Boston'\r\n  },\r\n  {\r\n    path: '/maps/concord',\r\n    title: 'Concord'\r\n  }\r\n]\r\n\r\nexport class Interface extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      renderPano: true\r\n    }\r\n  }\r\n\r\n  gmapComponent;\r\n  panoComponent;\r\n\r\n \r\n\r\n  render() {\r\n    return (\r\n      <Router>\r\n        <Container>\r\n          {<Header>\r\n            {routes.map(r => (\r\n              <NavLink\r\n                to={r.path}\r\n                key={r.path}\r\n                activeClassName=\"ir-nav-item__active\"\r\n                className=\"ir-nav-item\"\r\n              >\r\n                {r.title}\r\n              </NavLink>\r\n            ))}\r\n            </Header>}\r\n          <Content>\r\n            <Route path=\"/maps/:region\">\r\n              <GMap />\r\n              <Route\r\n                path=\"/viewPano/:id\"\r\n                component={props => ((this.state as any).renderPano ? <Pano {...props} /> : null)}\r\n              />\r\n            </Route>\r\n            <Redirect exact from=\"/\" to=\"/maps/center\" />\r\n            <Redirect exact from=\"/maps\" to=\"/maps/center\" />\r\n            <Redirect exact from=\"/maps/\" to=\"/maps/center\" />\r\n          </Content>\r\n        </Container>\r\n      </Router>\r\n    )\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './style/index.css';\r\nimport * as App from './App';\r\n\r\nReactDOM.render(<App.Interface />, document.getElementById('interface'));\r\n\r\n"],"sourceRoot":""}